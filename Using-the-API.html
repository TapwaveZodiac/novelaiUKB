<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc-markdown-css-theme" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Using the API</title>
  <style>
  :root {
    --solarized-base03:  #002b36;
    --solarized-base02:  #073642;
    --solarized-base01:  #586e75;
    --solarized-base00:  #657b83;
    --solarized-base0:   #839496;
    --solarized-base1:   #93a1a1;
    --solarized-base2:   #eee8d5;
    --solarized-base3:   #fdf6e3;
    --solarized-yellow:  #b58900;
    --solarized-orange:  #cb4b16;
    --solarized-red:     #dc322f;
    --solarized-magenta: #d33682;
    --solarized-violet:  #6c71c4;
    --solarized-blue:    #268bd2;
    --solarized-cyan:    #2aa198;
    --solarized-green:   #859900;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --solarized-base03: #fdf6e3;
      --solarized-base02: #eee8d5;
      --solarized-base01: #93a1a1;
      --solarized-base00: #839496;
      --solarized-base0:  #657b83;
      --solarized-base1:  #586e75;
      --solarized-base2:  #073642;
      --solarized-base3:  #002b36;
    }
  }

  pre, pre.numberSource {
    background: var(--solarized-base3);
    /* border: 1px solid var(--solarized-base2); */
    --color-code-highlight-bg: var(--solarized-base2);
  }
  pre code { color: var(--solarized-base00); }
  pre.numberSource > code.sourceCode > span > a:first-child::before {
    color: var(--solarized-base1);
  }
  code span.kw { color: var(--solarized-green);  font-weight: normal; font-style: normal; } /* Keyword */
  code span.dt { color: var(--solarized-yellow); font-weight: normal; font-style: normal; } /* DataType */
  code span.dv { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* DecVal */
  code span.bn { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* BaseN */
  code span.fl { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* Float */
  code span.ch { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* Char */
  code span.st { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* String */
  code span.co { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* Comment */
  code span.ot { color: var(--solarized-blue);   font-weight: normal; font-style: normal; } /* Other */
  code span.al { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* Alert */
  code span.fu { color: var(--solarized-blue);   font-weight: normal; font-style: normal; } /* Function */
  code span.er { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* Error */
  code span.wa { color: var(--solarized-orange); font-weight: normal; font-style: italic; } /* Warning */
  code span.cn { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* Constant */
  code span.sc { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* SpecialChar */
  code span.vs { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* VerbatimString */
  code span.ss { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* SpecialString */
  code span.im { color: var(--solarized-base00); font-weight: normal; font-style: normal; } /* Import */
  code span.va { color: var(--solarized-blue);   font-weight: normal; font-style: normal; } /* Variable */
  code span.cf { color: var(--solarized-green);  font-weight: normal; font-style: normal; } /* ControlFlow */
  code span.op { color: var(--solarized-green);  font-weight: normal; font-style: normal; } /* Operator */
  code span.bu { color: var(--solarized-base00); font-weight: normal; font-style: normal; } /* BuiltIn */
  code span.ex { color: var(--solarized-base00); font-weight: normal; font-style: normal; } /* Extension */
  code span.pp { color: var(--solarized-orange); font-weight: normal; font-style: normal; } /* Preprocessor */
  code span.at { color: var(--solarized-base00); font-weight: normal; font-style: normal; } /* Attribute */
  code span.do { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* Documentation */
  code span.an { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* Annotation */
  code span.cv { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* CommentVar */
  code span.in { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* Information */
  a.sourceLine::before { text-decoration: none; }

  /* pandoc diff mode */
  code.diff span.kw { color: var(--solarized-yellow); font-weight: normal; font-style: normal; } /* --- lines */
  code.diff span.dt { color: var(--solarized-blue);   font-weight: normal; font-style: normal; } /* +++ lines, @@ ... @@ lines */
  code.diff span.st { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* - lines */
  code.diff span.va { color: var(--solarized-green);  font-weight: normal; font-style: normal; } /* + lines */

  </style>
  <style>

  /* ----- Global settings ----------------------------------------------- {{{ */

  :root {
    /* --- Colors --- */
    --background-color: #161313;

    --color-text: #f7f5f2;
    --color-text-secondary: #9d9b99;
    --color-link: #bc805d;
    --color-sidenote: #b4b2af;

    --highlight-red: #660000;
    --highlight-yellow: #7f6000;
    --highlight-green: #274e13;
    --highlight-blue: #1c4587;
    --highlight-purple: #351c75;

    --color-inline-code: #f7f5f2;
    --color-inline-code-bg: #062b35;

    --color-border: #393635;
    --color-border-heavy: #524f4d;

    --color-table-heading: #242121;

    /* --- Text --- */

    --font-family-prose: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;
    --font-family-heading: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;
    --font-family-code: Menlo, monospace;
    --side-note-number-font-family: var(--font-family-prose);

    --line-height: 26px;
    --font-size: 17px;

    --inline-code-font-size: 15px;
    --code-block-font-size: 14px;
    --code-block-side-padding: 8px;
    --line-numbers-font-size: 12px;

    --tight-code-line-height: 18px;
    --tight-code-padding-top: 5px;

    --side-note-line-height: 20px;
    --side-note-font-size: 13px;
    --side-note-code-font-size: 13px;
    --side-note-baseline-offset: 4px;
    --side-note-sup-offset: -6px;
    --side-note-number-hang-left: -6px;
    --side-note-text-indent: -9px;

    --heading-font-weight: 500;

    --title-font-size: 42px;
    --title-code-font-size: 40px;
    --title-line-height: 48px;
    --title-margin-top: 92px;

    --h1-font-size: 32px;
    --h1-code-font-size: 29px;
    --h1-line-height: 36px;
    --h1-word-spacing: 1px;
    --h1-margin-top: 30px;
    --h1-margin-bottom: 12px;

    --h2-font-size: 22px;
    --h2-code-font-size: 20px;
    --h2-line-height: 28px;
    --h2-word-spacing: 0.5px;
    --h2-margin-top: 18px;
    --h2-margin-bottom: 6px;

    --ul-indent-size: 23px;
    --ol-indent-size: 19px;
    --ol-li-padding-left: 4px;

    --hr-margin-top: 18px;
    --hr-margin-bottom: calc(var(--line-height) - var(--hr-margin-top) - 1px);

    --extra-wide-scale-factor: 1.5;

    --figcaption-line-height: 21px;
    --figcaption-font-size: 14px;
    --figcaption-code-font-size: 13px;
    --figcaption-gap: 6px;
    --captioned-figure-gap: 10px;

    --table-line-height: 21px;
    --table-font-size: 14px;
    --table-code-font-size: 13px;

    --nav-toc-font-size: 12px;
    --nav-toc-code-font-size: 12px;
    --nav-toc-indent: 15px;
    --nav-toc-baseline-offset: 2px;

    /* --- Layout --- */

    --main-width: 745px * 2;
    /* The name doesn't indicate it, but this variable actually specifies an
     * effective minimum width. (It didn't previously behave this way, but the
     * change to do so was made in a backwards-compatible way, so the variable
     * was not renamed.)
     **/
    --main-width-narrow: 550px;
    --side-note-max-width: 300px;

  }


  *, *:after, *:before {
    box-sizing: border-box;
    margin: 0;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  html {
    /* https://github.com/edwardtufte/tufte-css/issues/81#issuecomment-261953409 */
    -webkit-text-size-adjust: 100%;
  }

  body {
    font-family: var(--font-family-prose);
    color: var(--color-text);
    font-size: var(--font-size);
    line-height: var(--line-height);
    -webkit-font-variant-ligatures: no-common-ligatures;
    font-variant-ligatures: no-common-ligatures;

    /* Safari-only right now (macOS, iOS) but looks so good. */
    hanging-punctuation: first;

    margin: 0;
    padding: 0;
    padding-top: var(--title-margin-top);
    width: 100%;

    background-color: var(--background-color);
  }

  @media print {
    body {
      background-color: initial;
    }
  }

  /* }}} */
  /* ----- Utility classes -----------------------------------------------  {{{ */
  .only-light-mode {
    display: inherit;
  }
  .only-dark-mode {
    display: none;
  }

  @media (prefers-color-scheme: dark) {
    .only-light-mode {
      display: none;
    }
    .only-dark-mode {
      display: inherit;
    }
  }
  /* }}} */
  /* ----- Side notes and margin notes ----------------------------------- {{{ */
  /* --- Side note text and numbering --- {{{ */

  .sidenote,
  .marginnote {
    color: var(--color-sidenote);

    font-size: var(--side-note-font-size);
    line-height: var(--side-note-line-height);
    vertical-align: baseline;

    /* Align first baseline to body. */
    margin-top: var(--side-note-baseline-offset);
  }

  .sidenote code,
  .marginnote code {
    color: var(--color-sidenote);
  }

  main {
    counter-reset: sidenote-counter;
  }

  .sidenote-number {
    counter-increment: sidenote-counter;
  }

  .sidenote-number:after,
  .sidenote:before {
    content: counter(sidenote-counter);
    position: relative;
  }

  nav#TOC label,
  label.margin-toggle:not(.sidenote-number),
  .sidenote-number:after,
  .sidenote:before,
  .footnote-ref sup,
  sup {
    font-size: var(--side-note-font-size);
    font-weight: 700;
    font-family: var(--side-note-number-font-family);
    -webkit-font-feature-settings: "tnum" 1;
    font-feature-settings: "tnum" 1;

    /* Mimic 'vertical-align: super' (browser style for sup tag)
     * without causing a gap in our text's implicit grid. */
    vertical-align: baseline;
    position: relative;
    top: var(--side-note-sup-offset);
  }

  sup {
    font-weight: inherit;
  }

  /* Make the superscript hang. */
  .sidenote:before { left: var(--side-note-number-hang-left); }
  /* Get first first column of first row to line up with other rows. */
  .sidenote { text-indent: var(--side-note-text-indent); }

  /*}}} */
  /* --- Side note input controls --- {{{ */

  input.margin-toggle {
      display: none;
  }
  label.margin-toggle:not(.sidenote-number) {
      display: none;
  }
  label.sidenote-number {
      display: inline;
  }

  /* Unfortunately, variables aren't in scope here.
   * See calculations in Horizontal layouting.
   */
  @media screen and (max-width: calc(26px + 550px + 26px + 169px + 26px - 1px)) {
    .margin-toggle:checked + .sidenote,
    .margin-toggle:checked + .marginnote {
      margin-top: var(--side-note-line-height);
      vertical-align: baseline;
    }

    label.margin-toggle {
      color: var(--color-link);
    }

    label.margin-toggle:not(.sidenote-number) {
      display: inline;
    }

    label {
      cursor: pointer;
    }
  }

  /* }}} */
  /* }}} */
  /* ----- Headings ------------------------------------------------------ {{{ */

  h1, h2 {
    font-family: var(--font-family-heading);
    font-weight: var(--heading-font-weight);
  }

  h4, h5, h6 {
    font-weight: normal;
  }

  h1.title {
    margin-top: var(--line-height);
    margin-bottom: var(--line-height);
    font-size: var(--title-font-size);
    line-height: var(--title-line-height);
  }

  h1.title code {
    font-size: var(--title-code-font-size);
  }

  h1:not(.title) {
    font-size: var(--h1-font-size);
    line-height: var(--h1-line-height);
    word-spacing: var(--h1-word-spacing);

    margin-top: var(--h1-margin-top);
    margin-bottom: var(--h1-margin-bottom);
  }

  h1:not(.title) code {
    font-size: var(--h1-code-font-size);
  }

  h2 {
    font-size: var(--h2-font-size);
    line-height: var(--h2-line-height);
    word-spacing: var(--h2-word-spacing);

    margin-top: var(--h2-margin-top);
    margin-bottom: var(--h2-margin-bottom);
  }

  h2 code {
    font-size: var(--h2-code-font-size);
  }

  h3 {
    font-size: var(--font-size);
    line-height: var(--line-height);
    font-weight: bold;
  }

  h1:not(.title) + *, h1:not(.title) + p { margin-top: var(--h1-margin-bottom); }
  h2 + *, h2 + p                         { margin-top: var(--h2-margin-bottom); }
  h3 + *, h3 + p                         { margin-top: 0; }

  /* }}} */
  /* ----- Prose --------------------------------------------------------- {{{ */

  p, main > ul, main > ol, div.sourceCode, main > pre, img, table {
    margin-top: var(--line-height);
    margin-bottom: var(--line-height)
  }

  ol {
    margin-left: var(--ol-indent-size);
  }

  ul.task-list {
    list-style: none;
    margin-left: var(--ul-indent-size);
  }

  ul.task-list > li {
    position: relative;
  }

  ul.task-list > li > input[type="checkbox"] {
    position: absolute;
    left: calc(-1 * var(--ul-indent-size));
    height: var(--line-height);
  }

  ol > li {
    padding-left: var(--ol-li-padding-left);
  }

  ol                         { list-style-type: decimal; }
  ol ol                      { list-style-type: lower-alpha; }
  ol ol ol                   { list-style-type: lower-roman; }
  ol ol ol ol                { list-style-type: decimal; }
  ol ol ol ol ol             { list-style-type: lower-alpha; }
  ol ol ol ol ol ol          { list-style-type: lower-roman; }
  ol ol ol ol ol ol ol       { list-style-type: decimal; }
  ol ol ol ol ol ol ol ol    { list-style-type: lower-alpha; }
  ol ol ol ol ol ol ol ol ol { list-style-type: lower-roman; }

  ul                         { list-style-type: disc; }
  ul ul                      { list-style-type: circle; }
  ul ul ul                   { list-style-type: square; }
  ul ul ul ul                { list-style-type: disc; }
  ul ul ul ul ul             { list-style-type: circle; }
  ul ul ul ul ul ul          { list-style-type: square; }
  ul ul ul ul ul ul ul       { list-style-type: disc; }
  ul ul ul ul ul ul ul ul    { list-style-type: circle; }
  ul ul ul ul ul ul ul ul ul { list-style-type: square; }

  blockquote {
    border-left: 1px solid var(--color-text-secondary);
    padding-left: 1.5rem;

    font-style: italic;
  }

  blockquote > p {
    margin-top: 0;
  }

  blockquote em, blockquote i, blockquote .sidenote-wrapper {
    font-style: normal;
  }

  hr {
    margin-top: var(--hr-margin-top);
    margin-bottom: var(--hr-margin-bottom);
    border-style: solid;
    color: var(--color-border-heavy);
    border-width: 1px 0 0;
  }

  a code, a:link code, a:visited code,
  a, a:link, a:visited {
    color: var(--color-link);
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  span.mark, mark {
    /* Reset browser styles */
    color: inherit;

    padding: 2px 0 1px;
  }
  span.mark.red,    mark.red    { background-color: var(--highlight-red);    }
  span.mark.yellow, mark.yellow { background-color: var(--highlight-yellow); }
  span.mark.green,  mark.green  { background-color: var(--highlight-green);  }
  span.mark.blue,   mark.blue   { background-color: var(--highlight-blue);   }
  span.mark.purple, mark.purple { background-color: var(--highlight-purple); }

  .subtitle {
    margin-top: 0;
  }
  .author, .date {
    margin-top: 0;
    margin-bottom: 0;
  }
  .signoff {
    margin-top: calc(4 * var(--line-height));
    margin-bottom: calc(4 * var(--line-height));
  }

  /* Pandoc utility classes */
  span.smallcaps{ font-variant: small-caps; }
  span.underline{ text-decoration: underline; }

  .katex-display {
    background: var(--background-color);
    transform: translateZ(0px);
  }

  @media print {
    .katex-display {
      background-color: initial;
    }
  }

  /* }}} */
  /* ----- Code ---------------------------------------------------------- {{{ */

  /* Pandoc code blocks with a language look like div.sourceCode > pre.sourceCode
   * Otherwise, it's just a pre (without .sourceCode)
   *
   * The 'code' element is tricky because it's used for inline code and code in a
   * pre.
   */

  code {
    font-family: var(--font-family-code);

    word-spacing: normal;

    /* Only for inline code */
    color: var(--color-inline-code);
    background-color: var(--color-inline-code-bg);
    font-size: var(--inline-code-font-size);
    margin: 0;
    padding: 2px 0 1px;
    border: 1px solid var(--color-border);
    border-radius: 1px;
  }

  .sidenote code,
  .marginnote code {
    font-size: var(--side-note-code-font-size);
  }

  pre code {
    /* Reset some changes meant to be inline-only */
    color: var(--color-inline-code);
    background-color: var(--color-inline-code-bg);
    font-size: var(--code-block-font-size);
    line-height: var(--line-height);
    margin: initial;
    padding: initial;
    border: initial;
    border-radius: initial;
  }

  pre > code {
    position: relative; /* For line highlights */
    display: inline-block;
    min-width: 100%;
    z-index: 1;

    white-space: pre-wrap;

    padding: 0 var(--code-block-side-padding);
  }

  code.sourceCode::selection {
    /* Prevent bug where far right edge of text box shows as selected. */
    background: transparent;
  }

  .wide > pre, .wide > div.sourceCode {
    /* Put this in front of the table of contents */
    transform: translateZ(0px);
  }

  .wide pre > code {
    white-space: pre;
  }

  pre.numberSource code {
    counter-reset: source-line 0;
  }

  pre > code.sourceCode > span {
    line-height: var(--line-height);

    display: inline-block;
    min-width: 100%;
  }

  div.sourceCode {
    /* Need to make room for line numbers (even if they're not going to be used).
     * Width doesn't matter, just needs to be big enough to hold the largest line
     * number. */
    --line-numbers-width: calc(4 * var(--line-numbers-font-size));
    --line-numbers-negative-width: calc(-1 * var(--line-numbers-width));
    margin-left: var(--line-numbers-negative-width);
  }
  div.sourceCode > pre {
    margin-left: var(--line-numbers-width);
  }
  pre.numberSource > code.sourceCode > span {
    counter-increment: source-line;
    padding-left: var(--line-numbers-width);
    text-indent: var(--line-numbers-negative-width);
    position: relative;
    left: var(--line-numbers-negative-width);
  }
  pre.numberSource > code.sourceCode > span > a:first-child::before {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

    content: counter(source-line);
    font-size: var(--line-numbers-font-size);
    text-decoration: none;

    position: relative;
    text-align: right;
    display: inline-block;

    padding: 0 calc(2 * var(--code-block-side-padding));
    width: var(--line-numbers-width);
  }
  pre > code.sourceCode > span > a:first-child::before:hover {
    text-decoration: underline;
  }

  /* Utility class for code blocks that contain things like box drawing characters, where it's nice for things to touch. */
  .tight-code pre,
  pre.tight-code {
    padding-top: var(--tight-code-padding-top);
  }

  pre.tight-code code,
  .tight-code pre code,
  .tight-code pre > code.sourceCode > span,
  pre.tight-code > code.sourceCode > span {
    line-height: var(--tight-code-line-height);
  }

  /* --- Code line highlights --- {{{ */
  /* I used some code I contributed to owickstrom's pandoc-emphasize-code[1] as
   * inspiration for these changes.
   *
   * The novel part is using :nth-of-type(...) selectors and CSS classes, instead
   * of needing a pandoc filter. This means that we can stick with pandoc's
   * default syntax highlighter, and not need to requirer JavaScript for syntax
   * highlighting. It has the obvious limitation that it places a fixed limit on
   * lines that can be highlighted, but these additional CSS styles are easy
   * enough to write, so anyone who needs more lines can write their own
   * stylesheet and include it to add more after the fact.
   *
   * [1] https://github.com/owickstrom/pandoc-emphasize-code/pull/3
   */

  pre > code.sourceCode > span::after {
    position: absolute;
    background-color: var(--color-code-highlight-bg);
    z-index: -1;
    left: calc(var(--line-numbers-width) - var(--code-block-side-padding));
    right: calc(var(--line-numbers-negative-width) - var(--code-block-side-padding));
    top: 0;
    height: 100%;
  }

  pre.hl-1  > code.sourceCode > span:nth-of-type(1)::after  { content: ""; }
  pre.hl-2  > code.sourceCode > span:nth-of-type(2)::after  { content: ""; }
  pre.hl-3  > code.sourceCode > span:nth-of-type(3)::after  { content: ""; }
  pre.hl-4  > code.sourceCode > span:nth-of-type(4)::after  { content: ""; }
  pre.hl-5  > code.sourceCode > span:nth-of-type(5)::after  { content: ""; }
  pre.hl-6  > code.sourceCode > span:nth-of-type(6)::after  { content: ""; }
  pre.hl-7  > code.sourceCode > span:nth-of-type(7)::after  { content: ""; }
  pre.hl-8  > code.sourceCode > span:nth-of-type(8)::after  { content: ""; }
  pre.hl-9  > code.sourceCode > span:nth-of-type(9)::after  { content: ""; }
  pre.hl-10 > code.sourceCode > span:nth-of-type(10)::after { content: ""; }
  pre.hl-11 > code.sourceCode > span:nth-of-type(11)::after { content: ""; }
  pre.hl-12 > code.sourceCode > span:nth-of-type(12)::after { content: ""; }
  pre.hl-13 > code.sourceCode > span:nth-of-type(13)::after { content: ""; }
  pre.hl-14 > code.sourceCode > span:nth-of-type(14)::after { content: ""; }
  pre.hl-15 > code.sourceCode > span:nth-of-type(15)::after { content: ""; }
  pre.hl-16 > code.sourceCode > span:nth-of-type(16)::after { content: ""; }
  pre.hl-17 > code.sourceCode > span:nth-of-type(17)::after { content: ""; }
  pre.hl-18 > code.sourceCode > span:nth-of-type(18)::after { content: ""; }
  pre.hl-19 > code.sourceCode > span:nth-of-type(19)::after { content: ""; }
  pre.hl-20 > code.sourceCode > span:nth-of-type(20)::after { content: ""; }
  pre.hl-21 > code.sourceCode > span:nth-of-type(21)::after { content: ""; }
  pre.hl-22 > code.sourceCode > span:nth-of-type(22)::after { content: ""; }
  pre.hl-23 > code.sourceCode > span:nth-of-type(23)::after { content: ""; }
  pre.hl-24 > code.sourceCode > span:nth-of-type(24)::after { content: ""; }
  pre.hl-25 > code.sourceCode > span:nth-of-type(25)::after { content: ""; }
  pre.hl-26 > code.sourceCode > span:nth-of-type(26)::after { content: ""; }
  pre.hl-27 > code.sourceCode > span:nth-of-type(27)::after { content: ""; }
  pre.hl-28 > code.sourceCode > span:nth-of-type(28)::after { content: ""; }
  pre.hl-29 > code.sourceCode > span:nth-of-type(29)::after { content: ""; }
  pre.hl-30 > code.sourceCode > span:nth-of-type(30)::after { content: ""; }
  pre.hl-31 > code.sourceCode > span:nth-of-type(31)::after { content: ""; }
  pre.hl-32 > code.sourceCode > span:nth-of-type(32)::after { content: ""; }
  pre.hl-33 > code.sourceCode > span:nth-of-type(33)::after { content: ""; }
  pre.hl-34 > code.sourceCode > span:nth-of-type(34)::after { content: ""; }
  pre.hl-35 > code.sourceCode > span:nth-of-type(35)::after { content: ""; }
  pre.hl-36 > code.sourceCode > span:nth-of-type(36)::after { content: ""; }
  pre.hl-37 > code.sourceCode > span:nth-of-type(37)::after { content: ""; }
  pre.hl-38 > code.sourceCode > span:nth-of-type(38)::after { content: ""; }
  pre.hl-39 > code.sourceCode > span:nth-of-type(39)::after { content: ""; }
  pre.hl-40 > code.sourceCode > span:nth-of-type(40)::after { content: ""; }

  /* }}} */

  /* }}} */
  /* ----- Images and figures -------------------------------------------- {{{ */

  /* There's only a figure if there's a caption. Tighten things up. */
  figure {
    margin-bottom: var(--captioned-figure-gap);
  }

  figure + p {
    margin-top: var(--captioned-figure-gap);
  }

  figure > img, figure > pre, figure > div.sourceCode {
    margin-bottom: var(--figcaption-gap);
  }

  img {
    display: block;
  }

  .wide img {
    /* Put this in front of the table of contents */
    transform: translateZ(0px);
  }

  figcaption {
    font-size: var(--figcaption-font-size);
    line-height: var(--figcaption-line-height);
    font-style: italic;
    text-align: center;
    color: var(--color-text-secondary);
  }

  .left-align-caption figcaption {
    text-align: left;
  }

  figcaption code {
    font-size: var(--figcaption-code-font-size);
  }

  /* }}} */
  /* ----- Tables -------------------------------------------------------- {{{ */

  table {
    -webkit-font-feature-settings: "tnum" 1;
    font-feature-settings: "tnum" 1;

    font-size: var(--table-font-size);
    line-height: var(--table-line-height);

    border-spacing: 0;
    border-collapse: collapse;
    border: 1px solid var(--color-border-heavy);

    width: 100%;

    /* Solid background to occlude table of contents */
    background-color: var(--background-color);
  }

  @media print {
    table {
      background-color: initial;
    }
  }

  table code {
    font-size: var(--table-code-font-size);
  }

  table pre code {
    font-size: inherit;
  }

  .wide table {
    /* Put this in front of the table of contents */
    transform: translateZ(0px);
  }

  table td, table th {
    border: 1px solid var(--color-border-heavy);
    padding: 5px 8px;
    min-width: 100px;
  }
  table th {
    background-color: var(--color-table-heading);
  }

  table > caption {
    caption-side: bottom;
    margin-top: var(--figcaption-gap);
    margin-bottom: calc(var(--captioned-figure-gap) - var(--line-height));
    font-size: var(--figcaption-font-size);
    line-height: var(--figcaption-line-height);
    font-style: italic;
    text-align: center;
    color: var(--color-text-secondary);
  }

  .left-align-caption table > caption {
    text-align: left;
  }

  table > caption code {
    font-size: var(--figcaption-code-font-size);
  }

  /* --- Notes are just single cell tables --- */

  .note table {
    font-size: inherit;
    line-height: inherit;
  }
  .note table, .note td {
    border: none;
  }

  .note.red    td { background: var(--highlight-red); }
  .note.yellow td { background: var(--highlight-yellow); }
  .note.green  td { background: var(--highlight-green); }
  .note.blue   td { background: var(--highlight-blue); }
  .note.purple td { background: var(--highlight-purple); }

  /* }}} */
  /* ----- Table of contents --------------------------------------------- {{{ */

  .date.before-toc {
    padding-bottom: var(--line-height);
  }

  nav#TOC label {
    color: var(--color-link);
    cursor: pointer;
  }

  nav#TOC code,
  nav#TOC a,
  nav#TOD a:link,
  nav#TOD a:visited {
    color: var(--color-text-secondary);
  }

  header {
    margin-bottom: var(--line-height);
  }

  .date.before-toc {
    padding-bottom: initial;
  }

  nav#TOC code {
    font-size: var(--nav-toc-code-font-size);
  }

  nav#TOC a:hover,
  nav#TOC a:hover code {
    text-decoration: none;
    color: var(--color-link);
  }

  /* }}} */
  /* ----- Horizontal layouting (main, side notes, extra-wide) ----------- {{{ */

  .sidenote,
  .marginnote {
    float: right;
    clear: right;
    position: relative;

    width: var(--computed-width);
    max-width: var(--side-note-max-width);
    margin-right: calc(-1 * min(var(--computed-width), var(--side-note-max-width)) - var(--margin-left));
  }

  /* --- Side notes and table of contents always visible --- {{{ */

  /* Unfortunately, variables aren't in scope here.
   * 745px = --main-width
   * 52px = 2 * --line-height
   * 206px = side note min width
   */
  @media screen and (min-width: calc(745px + 2 * (52px + 206px + 52px))) {
    header,
    main,
    footer {
      max-width: var(--main-width);
    }

    header,
    main,
    footer {
      margin-left: auto;
      margin-right: auto;
    }

    .sidenote,
    .marginnote {
      --margin-left: calc(2 * var(--line-height));
      --margin-right: var(--margin-left);
      --computed-width: calc((100vw - 100%) / 2 - var(--margin-right) - var(--margin-left));
    }

    .wide {
      width: 100%;
      overflow-x: auto;
    }

    .wide.extra-wide {
      margin-left: calc((1 - var(--extra-wide-scale-factor)) / 2 * 100%);
      width: calc(var(--extra-wide-scale-factor) * 100%);
    }

    .wide.full-width {
      margin-left: calc(var(--line-height) - ((100vw - var(--main-width)) / 2));
      width: calc(100vw - 2 * var(--line-height));
    }

    .wide.extra-wide figcaption,
    .wide.extra-wide table > caption {
      margin-left: calc(((var(--extra-wide-scale-factor) - 1) / 2) * var(--main-width));
      max-width: var(--main-width);
      margin-right: calc(100% - var(--main-width) - (((var(--extra-wide-scale-factor) - 1) / 2) * var(--main-width)));
    }

    .wide.full-width figcaption,
    .wide.full-width table > caption {
      margin-left: calc((100vw - var(--main-width)) / 2 - var(--line-height));
      max-width: var(--main-width);
      margin-right: calc(100% - var(--main-width) - ((100vw - var(--main-width)) / 2 - var(--line-height)));
    }
  }

  /* }}} */
  /* --- Side notes visibile, table of contents collapsed, double-wide margins --- {{{ */

  /* Unfortunately, variables aren't in scope here.
   * 745px = --main-width
   * 52px = 2 * --line-height
   * 206px = side note min width
   */
  @media screen and (min-width: calc(52px + 745px + 52px + 206px + 52px)) and (max-width: calc(745px + 2 * (52px + 206px + 52px) - 1px)) {
    .sidenote,
    .marginnote {
      --margin-left: calc(2 * var(--line-height));
      --margin-right: var(--margin-left);
      --computed-width: calc(100vw - var(--main-width) - calc(2 * var(--line-height)) - var(--margin-right) - var(--margin-left));
    }

    .wide {
      width: 100%;
      overflow-x: auto;
      overflow-y: hidden;
    }

    .wide.extra-wide {
      margin-left: calc(-1 * var(--line-height));
      width: calc(100vw - 2 * var(--line-height));
      max-width: calc(var(--extra-wide-scale-factor) * var(--main-width));
    }

    .wide.full-width {
      margin-left: calc(-1 * var(--line-height));
      width: calc(100vw - 2 * var(--line-height));
      max-width: calc(100vw - 2 * var(--line-height));
    }

    .wide.extra-wide .katex-display,
    .wide.full-width .katex-display {
      padding-left: var(--line-height);
      padding-right: var(--line-height);
    }

    .wide.extra-wide .katex-display,
    .wide.extra-wide .katex-display > .katex,
    .wide.full-width .katex-display,
    .wide.full-width .katex-display > .katex {
      text-align: left;
    }

    .wide.extra-wide figcaption,
    .wide.extra-wide table > caption,
    .wide.full-width figcaption,
    .wide.full-width table > caption {
      text-align: left;
      margin-left: var(--line-height);
      max-width: var(--main-width);
    }
  }

  /* }}} */
  /* --- Side notes visibile, table of contents collapsed --- {{{ */

  /* Unfortunately, variables aren't in scope here.
   * 550px = --main-width-narrow
   * 26px = --line-height
   * 169px = side note min width narrow
   */
  @media screen and (min-width: calc(26px + 550px + 26px + 169px + 26px)) and (max-width: calc(52px + 745px + 52px + 206px + 52px - 1px)) {
    .sidenote,
    .marginnote {
      --margin-left: var(--line-height);
      --margin-right: var(--line-height);
      --computed-width: calc(100vw - var(--main-width-narrow) - var(--line-height) - var(--margin-right) - var(--margin-left));
    }

    .wide {
      width: var(--main-width);
      overflow-x: auto;
      overflow-y: hidden;
    }

    .wide .katex-display,
    .wide .katex-display > .katex {
      text-align: left;
    }

    .wide figcaption,
    .wide table > caption {
      text-align: left;
      max-width: var(--main-width-narrow);
    }

    .wide.extra-wide,
    .wide.full-width {
      width: calc(100vw - 2 * var(--line-height));
    }
  }

  /* }}} */
  /* --- Side notes and table of contents collapsed --- {{{ */

  /* Unfortunately, variables aren't in scope here.
   * See calculations above.
   */
  @media screen and (max-width: calc(26px + 550px + 26px + 169px + 26px - 1px)) {
    .sidenote,
    .marginnote {
      display: none;
    }

    .wide {
      width: 100%;
      overflow-x: auto;
      overflow-y: hidden;
    }

    .wide .katex-display,
    .wide .katex-display > .katex {
      text-align: left;
    }

    .wide figcaption,
    .wide table > caption {
      text-align: left;
      max-width: calc(100vw - 2 * var(--line-height));
    }
  }

  /* }}} */
  /* --- Paged media (print styles) --- {{{ */
  @page {
    size: letter;
    margin: 0.5in;
    /* To make room for line numbers in left margin. */
    margin-left: 0.25in;
  }

  @media print {
    :root {
      --line-height: 18px;
      --font-size: 12px;

      --inline-code-font-size: 11px;
      --code-block-font-size: 10px;
      --code-block-side-padding: 6px;
      --line-numbers-font-size: 8.5px;

      --tight-code-line-height: 12.5px;
      --tight-code-padding-top: 2px;

      --side-note-line-height: 14px;
      --side-note-font-size: 9px;
      --side-note-code-font-size: 9px;
      --side-note-baseline-offset: 3px;
      --side-note-sup-offset: -4px;
      --side-note-number-hang-left: -4px;
      --side-note-text-indent: -6.5px;

      --title-font-size: 30px;
      --title-code-font-size: 29px;
      --title-line-height: 37px;
      --title-margin-top: 71px;

      --h1-font-size: 22px;
      --h1-code-font-size: 20px;
      --h1-line-height: 28px;
      --h1-word-spacing: 0.5px;
      --h1-margin-top: 18px;
      --h1-margin-bottom: 6px;

      --h2-font-size: 16.5px;
      --h2-code-font-size: 15px;
      --h2-line-height: 22px;
      --h2-word-spacing: 0px;
      --h2-margin-top: 14px;
      --h2-margin-bottom: 4.5px;

      --ul-indent-size: 18px;
      --ol-indent-size: 14px;

      --hr-margin-top: 14px;

      --figcaption-line-height: 16px;
      --figcaption-font-size: 10px;
      --figcaption-code-font-size: 9.5px;
      --figcaption-gap: 4.5px;
      --captioned-figure-gap: 7.5px;

      --table-line-height: 16px;
      --table-font-size: 10px;
      --table-code-font-size: 9.5px;

      --nav-toc-font-size: 8.5px;
      --nav-toc-code-font-size: 8.5px;
    }

    body {
      padding-top: 0;
      /* To make room for line numbers in left margin. */
      padding-left: 0.25in;
    }

    .sidenote,
    .marginnote {
      width: 2in;
      margin-right: -2.25in;
    }

    .wide {
      width: 7.5in;
      overflow-x: hidden;
      overflow-y: hidden;
    }

    .wide .katex-display,
    .wide .katex-display > .katex {
      text-align: left;
    }

    .wide figcaption,
    .wide table > caption {
      text-align: left;
      width: 5.25in;
    }

    .wide pre > code {
      white-space: pre-wrap;
    }
  }

  h1, h2, h3 {
    page-break-after: avoid;
  }

  table, figure, pre, img {
    page-break-inside: avoid;
  }
  /* }}} */
  /* }}} */

  /* vim:fdm=marker
   */

  </style>
  <!-- CSS added by filter 'toc-css.lua' for TOC hovering to the side -->
  <!-- TODO: try doing sometthing in px instead of cm to make it more device independent -->
  <style>
  body {
    padding-left: 1.5cm;
    padding-right: 1cm;
    transition: 0.5s;
  }
  nav {
    width: 1cm;
    margin-left: -1.5cm;
    color: grey;
    transition: 0.5s;
    float: left;
    position: fixed;
    top: 0;
    bottom: 0;
    white-space: nowrap;
    overflow: hidden;
    overflow-y: scroll;
    transition: 0.5s;
    z-index: 10;
  }
  nav::-webkit-scrollbar {
    display: none;
  }
  nav a, nav a:visited {
    color: grey;
  }
  nav h2:before {
    content: "≡ ";
    font-size: 150%;
  }
  nav h2:after {
    content: " ◂";
  }
  nav > ul {
    padding-left: 1em;
  }
  nav li {
    margin-left: 1em;
    padding-left: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  nav ul {
    padding-left: 1em;
    margin-left: 0;
  }
  nav li > a:not(:only-child):before {
    content: "▸ ";
  }
  nav li li li {
    font-size: smaller;
  }
  nav ul li ul  {
    visibility: hidden;
    display: none;
    margin-top: 0.2em;
    margin-bottom: 0.2em;
    transition: 0.5s;
  }
  .paddingleft {
    padding-left: 11cm;
    transition: 0.5s;
  }
  .navside {
    width: 10cm;
    margin-left: -10.5cm;
    padding-right: 1em;
    transition: 0.5s;
  }
  .navside h2:after {
    content: " ▸ ";
  }
  .navshown {
    width: 50%;
    transition: 0.5s;
    background-color: rgba(16, 13, 13, 0.95);
  }
  .subShow > ul {
    visibility: visible;
    display: block;
    transition: 0.5s;
  }
  .subShow > a:not(:only-child):before {
    content: " ▾ ";
  }

  .toc-invisible {
    visibility: hidden;
  }
  .navside > .toc-invisible {
    visibility: visible;
  }
  .navshown > .toc-invisible {
    visibility: visible;
  }
  </style>
</head>
<body>

<header>
<h1 class="title">Using the API</h1>
<blockquote class="metadata">
  <p class="date before-toc"><time datetime="Last updated 23/09/2024 at 07:17">Last updated 23/09/2024 at 07:17</time></p>
</blockquote>
</header>

  <nav id="TOC" role="doc-toc">
      <h2 id="toc-title">Contents</h2>
    <ul>
    <li><a href="#1-introduction">1. Introduction</a></li>
    <li><a href="#2-the-endpoints">2. The endpoints</a>
    <ul>
    <li><a href="#21-terms-and-concepts">2.1. Terms and concepts</a>
    <ul>
    <li><a href="#211-access-key-and-access-token">2.1.1. Access key and Access token</a></li>
    <li><a href="#212-encryption-and-keystore">2.1.2. Encryption and Keystore</a></li>
    <li><a href="#213-compression">2.1.3. Compression</a></li>
    <li><a href="#214-compression-story-content">2.1.4. Compression (story content)</a></li>
    <li><a href="#215-logprobs">2.1.5. Logprobs</a></li>
    <li><a href="#216-infilling">2.1.6. Infilling</a></li>
    <li><a href="#217-hypebot">2.1.7. Hypebot</a></li>
    </ul></li>
    <li><a href="#22-endpoints-starting-with-">2.2. Endpoints starting with /</a>
    <ul>
    <li><a href="#221-">2.2.1. /</a></li>
    </ul></li>
    <li><a href="#23-endpoints-starting-with-user">2.3. Endpoints starting with /user/</a>
    <ul>
    <li><a href="#231-userregister">2.3.1. /user/register</a></li>
    <li><a href="#232-userlogin">2.3.2. /user/login</a></li>
    <li><a href="#233-userchange-access-key">2.3.3. /user/change-access-key</a></li>
    <li><a href="#234-userresend-email-verification">2.3.4. /user/resend-email-verification</a></li>
    <li><a href="#235-userverify-email">2.3.5. /user/verify-email</a></li>
    <li><a href="#236-userinformation">2.3.6. /user/information</a></li>
    <li><a href="#237-userdeletionrequest">2.3.7. /user/deletion/request</a></li>
    <li><a href="#238-userdeletiondelete">2.3.8. /user/deletion/delete</a></li>
    <li><a href="#239-userrecoveryrequest">2.3.9. /user/recovery/request</a></li>
    <li><a href="#2310-userrecoveryrecover">2.3.10. /user/recovery/recover</a></li>
    <li><a href="#2311-userdelete">2.3.11. /user/delete</a></li>
    <li><a href="#2312-userdata">2.3.12. /user/data</a></li>
    <li><a href="#2313-userpriority">2.3.13. /user/priority</a></li>
    <li><a href="#2314-usergiftkeys">2.3.14. /user/giftkeys</a></li>
    <li><a href="#2315-usersubscription">2.3.15. /user/subscription</a></li>
    <li><a href="#2316-userkeystore">2.3.16. /user/keystore</a></li>
    <li><a href="#2317-userobjectstype-type--stories-storycontent-aimodules-shelf-presets">2.3.17. /user/objects/{type} (type = "stories", "storycontent", "aimodules", "shelf", "presets")</a></li>
    <li><a href="#2318-userobjectstypeid">2.3.18. /user/objects/{type}/{id}</a></li>
    <li><a href="#2319-userclientsettings">2.3.19. /user/clientsettings</a></li>
    <li><a href="#2320-usersubmission">2.3.20. /user/submission</a></li>
    <li><a href="#2321-usersubmissionevent">2.3.21. /user/submission/{event}</a></li>
    <li><a href="#2322-uservote-submissionevent">2.3.22. /user/vote-submission/{event}</a></li>
    </ul></li>
    <li><a href="#24-usersubscription">2.4. /user/subscription/</a>
    <ul>
    <li><a href="#241-usersubscriptionbind">2.4.1. /user/subscription/bind</a></li>
    <li><a href="#242-usersubscriptionchange">2.4.2. /user/subscription/change</a></li>
    </ul></li>
    <li><a href="#25-ai">2.5. /ai/</a>
    <ul>
    <li><a href="#251-aigenerate">2.5.1. /ai/generate</a></li>
    <li><a href="#252-aigenerate-prompt">2.5.2. /ai/generate-prompt</a></li>
    <li><a href="#253-aigenerate-stream">2.5.3. /ai/generate-stream</a></li>
    <li><a href="#254-aiannotate-image">2.5.4. /ai/annotate-image</a></li>
    <li><a href="#255-aigenerate-image">2.5.5. /ai/generate-image</a></li>
    <li><a href="#256-aiupscale">2.5.6. /ai/upscale</a></li>
    <li><a href="#257-aiclassify">2.5.7. /ai/classify</a></li>
    <li><a href="#258-aigenerate-imagesuggest-tags">2.5.8. /ai/generate-image/suggest-tags</a></li>
    <li><a href="#259-aigenerate-voice">2.5.9. /ai/generate-voice</a></li>
    </ul></li>
    <li><a href="#26-aimodule">2.6. /ai/module/</a>
    <ul>
    <li><a href="#261-aimoduletrain">2.6.1. /ai/module/train</a></li>
    <li><a href="#262-aimoduleall">2.6.2. /ai/module/all</a></li>
    <li><a href="#263-aimoduleid">2.6.3. /ai/module/{id}</a></li>
    <li><a href="#264-aimodulebuy-training-steps">2.6.4. /ai/module/buy-training-steps</a></li>
    </ul></li>
    </ul></li>
    <li><a href="#3-unofficial-api-resources">3. Unofficial API resources</a></li>
    </ul>
</nav>

<main>
<p><strong>Written by <em>Aedial</em></strong></p>
<h1 id="1-introduction">1. Introduction</h1>
<p>The API is the backbone of the website. All text and image generation, storage your content, and much more happens through API requests. As such, it is possible to use API requests to interact with NovelAI's back-end in ways that are more elaborate and sometimes originally unintended by the developers. Due to this, using the API comes with some restrictions that must be followed (<a href="https://novelai.net/terms">ToS</a> - sections 5.3 and 9.1) :</p>
<ul>
<li><strong>No account sharing.</strong> Any request using your access token should be done by the owner of the account.</li>
<li><strong>No automation.</strong> There is some leeway, but the basis of it is that there should be some form of user interaction: <strong>requests should be sent by users, and never automatically through a script.</strong></li>
</ul>
<p>This means <strong>no public bots</strong> using a single API key, among other things. Making a tool that lets you send a small batch of staggered requests: OK. Making a tool that generates every 5s and downloads every result: Not OK.</p>
<p>In the same vein, all requests should be done one request at a time, as to not choke the server with too much load at once.</p>
<p>Failure to do so can result in your <strong>account's permanent termination</strong> or your <strong>right to free generations being suspended</strong></p>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/98bc914c-de64-4935-91d4-3bca412fb982" alt="image" /></p>
<h1 id="2-the-endpoints">2. The endpoints</h1>
<p>The official API docs can be viewed at <a href="https://api.novelai.net/docs">docs</a>, but might be vague about some aspects.</p>
<p>Here is a breakdown of each endpoint, but <strong>with only the <em>undocumented</em> arguments, types, and schemas</strong>. Documented args, types and schemas are present in the documentation. <strong>Each</strong> endpoint should be prepended with "<a href="https://api.novelai.net">https://api.novelai.net</a>" for <strong>text</strong>, and "<a href="https://image.novelai.net">https://image.novelai.net</a>" for images.</p>
<p>Several responses can come from any endpoint:</p>
<ul>
<li>A Cloudflare error with an HTML response</li>
<li>A normal error with a JSON response containing an "error" field for more information</li>
<li>The expected response</li>
</ul>
<h2 id="21-terms-and-concepts">2.1. Terms and concepts</h2>
<h3 id="211-access-key-and-access-token">2.1.1. Access key and Access token</h3>
<p>To access most of the API, you will need an <strong>Access token</strong>. This token is generated via the <strong>/user/login endpoint</strong>, and is valid for <strong>exactly 30 days</strong> (2592000 seconds) after its creation. When you have your access token, You can use it in the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Authorization">Authorization</a> header with the <strong>Bearer</strong> scheme.</p>
<p>To login, you will need to send your Access key to the /user/login endpoint. The Access key is derived from your <em>email and password</em> using the <strong>blake2 and argon2 algorithms</strong> (see <a href="https://github.com/Aedial/novelai-api/blob/8120fcb5db67cf01d254a40e49063b4e71355d17/novelai_api/utils.py#L43">here</a>).</p>
<p>There are several ways to get your access key :</p>
<ul>
<li>Implement /user/login or use a tool that implements it (recommended way, as you won't have to manually copy it when it expires)</li>
<li>Grab it from the Local Storage, having logged in beforehand (Browser's dev tools &gt; Storage &gt; Local Storage &gt; <a href="https://novelai.net">https://novelai.net</a> &gt; session - see image below)</li>
<li>Use an external tool (<span class="emoji" data-emoji="warning">⚠️</span> Do not trust any external tool unless you know what it does)</li>
</ul>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/37438fa2-9ebe-43d8-8d3d-73eb5c22bc5d" alt="image" /></p>
<h3 id="212-encryption-and-keystore">2.1.2. Encryption and Keystore</h3>
<p>"stories", "storycontent", and "aimodules" objects are encrypted using <a href="https://en.wikipedia.org/wiki/Salsa20">Salsa20/8</a>, in an <a href="https://en.wikipedia.org/wiki/End-to-end_encryption">End-to-End</a> manner. To get the key of an object, you will need to retrieve and decrypt your <strong>keystore</strong> with your <strong>Encryption key</strong>. The Encryption key is derived in the same manner as the Access key, using blake2 and argon2 (see <a href="https://github.com/Aedial/novelai-api/blob/8120fcb5db67cf01d254a40e49063b4e71355d17/novelai_api/utils.py#L49">here</a>).</p>
<p>The encrypted keystore contains the <strong>encrypted data</strong> ("sdata") and the <strong>nonce</strong> ("nonce") to be used to decrypt it (it is also encrypted using Salsa20), the key is your Encryption key. Once you have decrypted your keystore, you will see a mapping of meta -&gt; key. Each encrypted object has a "meta" field, which is used to link them to their encryption key (more info <a href="https://github.com/Aedial/novelai-api/blob/8120fcb5db67cf01d254a40e49063b4e71355d17/novelai_api/Keystore.py#L113">here</a> and <a href="https://github.com/Aedial/novelai-api/blob/8120fcb5db67cf01d254a40e49063b4e71355d17/novelai_api/utils.py#L63">here</a>).</p>
<p>Once you have the key of the object, you can decrypt it by removing the nonce that is stored in the 16 first bytes of the encrypted data, and decrypting the rest using this nonce and the key from the keystore (more info <a href="https://github.com/Aedial/novelai-api/blob/8120fcb5db67cf01d254a40e49063b4e71355d17/novelai_api/utils.py#L188">here</a> and <a href="https://github.com/Aedial/novelai-api/blob/8120fcb5db67cf01d254a40e49063b4e71355d17/novelai_api/utils.py#L63">here</a>).</p>
<h3 id="213-compression">2.1.3. Compression</h3>
<p>"shelf", "preset", and any decrypted object might be compressed using <a href="https://en.wikipedia.org/wiki/Deflate">DEFLATE</a>. It is easily recognizable as the data is prefixed with 0x00000000000000000000000000000001 (hex representation of byte data), which should be <strong>removed when decompressing</strong> and <strong>added back when compressing</strong> (note that the prefix is matched and removed <em>before decryption</em>, but the <em>decompression takes place after decryption</em> - see <a href="https://github.com/Aedial/novelai-api/blob/8120fcb5db67cf01d254a40e49063b4e71355d17/novelai_api/utils.py#L72">here</a>). The compression library used by the NAI is <a href="https://www.npmjs.com/package/fflate">fflate</a>, which might result in slightly different results, but should be fully compatible with the standard.</p>
<h3 id="214-compression-story-content">2.1.4. Compression (story content)</h3>
<p>Editor v2 uses compression for story content, which relies on a non-standard implementation of <a href="https://msgpack.org/">msgpack</a>, called <a href="https://github.com/kriszyp/msgpackr/">msgpackr</a>. The non-standard parts are records, bundled strings, and a few extensions. On top of that, custom extension 20, 30, 31, 40, 41, 42 are used to wrap the data in a class. As these are merely wrappers, they can be implemented as pass-throughs.</p>
<p>For implementation details on msgpackr for other languages, look at <a href="https://github.com/Aedial/msgpackr-python">msgpackr-python</a>.</p>
<h3 id="215-logprobs">2.1.5. Logprobs</h3>
<p>Logprobs, or logarithm of probabilities, are useful information for knowing where the AI is going. They are returned by text models when the parameter is enabled, and show the probability of the top alternatives in descending order, for a specific token. The logprobs come in the "logprobs" field of the response, and will contain a "chosen" field for the tokens that were chosen, and a "before" field for the top alternatives of these tokens, with their probability before and after applying sampling.</p>
<h3 id="216-infilling">2.1.6. Infilling</h3>
<p>Infilling, or Bidirectional inline generation, is a specific feature and a totally different way of generating, which takes into account both the text before and after the targeted spot.</p>
<p>The current model used for infilling is GPT-J-6B, but it is unsure whether it is a finetune or a module v2. It uses token 50261 as mask for the part to replace, token 50257 at the end of context sent to prompt it into infilling mode, and token 50258 for the end of generation (so put that as Stop sequence).</p>
<h3 id="217-hypebot">2.1.7. Hypebot</h3>
<p>Hypebot is a commenter bot, which sees the story and comments on it.</p>
<p>The current model used for hypebot is GPT-J-6B, finetuned on ~300 samples with some augmentation. It uses token 49527 at the end of context sent to prompt it into hypebot mode, and token 48585 for the end of generation (so put that as Stop sequence).</p>
<h2 id="22-endpoints-starting-with-">2.2. Endpoints starting with /</h2>
<h3 id="221-">2.2.1. /</h3>
<p>Checks if the API is reachable.</p>
<h2 id="23-endpoints-starting-with-user">2.3. Endpoints starting with /user/</h2>
<h3 id="231-userregister">2.3.1. /user/register</h3>
<p>Registers an account. Automation is mitigated by ReCaptcha.</p>
<h3 id="232-userlogin">2.3.2. /user/login</h3>
<p>Get a new access token from your access key.</p>
<h3 id="233-userchange-access-key">2.3.3. /user/change-access-key</h3>
<p>Change your access key and email (access key is based on email and password).</p>
<h3 id="234-userresend-email-verification">2.3.4. /user/resend-email-verification</h3>
<p>Send an email with a verification token to verify your email address.</p>
<h3 id="235-userverify-email">2.3.5. /user/verify-email</h3>
<p>Verify your email address with the verification token sent to it.</p>
<h3 id="236-userinformation">2.3.6. /user/information</h3>
<p>Get miscellaneous information about your account.</p>
<h3 id="237-userdeletionrequest">2.3.7. /user/deletion/request</h3>
<p>Send an email to the account deletion. The email address should be the same you provided for the registration.</p>
<h3 id="238-userdeletiondelete">2.3.8. /user/deletion/delete</h3>
<p>Confirm the account deletion with the deletion token to your email.</p>
<h3 id="239-userrecoveryrequest">2.3.9. /user/recovery/request</h3>
<p>Send an email to recover your account, in case you forgot your password. The email address should be the same you provided for the registration. <strong>Changing your password will make all stories permanently inaccessible, so make sure you back up everything!</strong></p>
<h3 id="2310-userrecoveryrecover">2.3.10. /user/recovery/recover</h3>
<p>Change your access key, using the recovery token sent to your email.</p>
<h3 id="2311-userdelete">2.3.11. /user/delete</h3>
<p>Delete the account.</p>
<h3 id="2312-userdata">2.3.12. /user/data</h3>
<p>Combination of all user data (/user/priority, /user/subscription, /user/keystore, /user/clientsettings, and /user/information)</p>
<h3 id="2313-userpriority">2.3.13. /user/priority</h3>
<p>Get the priority level. (Legacy system, now deprecated.)</p>
<h3 id="2314-usergiftkeys">2.3.14. /user/giftkeys</h3>
<p>Get the gift keys you bought</p>
<h3 id="2315-usersubscription">2.3.15. /user/subscription</h3>
<p>Get information about subscription, payment processor info, and current Anlas count</p>
<h3 id="2316-userkeystore">2.3.16. /user/keystore</h3>
<p>Get/Edit the keystore.</p>
<h3 id="2317-userobjectstype-type--stories-storycontent-aimodules-shelf-presets">2.3.17. /user/objects/{type} (type = "stories", "storycontent", "aimodules", "shelf", "presets")</h3>
<p>Get/Upload all the objects of a specific type, that you have uploaded to your account. "stories", "storycontent", and "aimodules" are encrypted, while "shelf" and "presets" are compressed (storycontent is both).</p>
<h3 id="2318-userobjectstypeid">2.3.18. /user/objects/{type}/{id}</h3>
<p>Get/Edit/Delete a specific object, that you have uploaded to your account.</p>
<h3 id="2319-userclientsettings">2.3.19. /user/clientsettings</h3>
<p>Get/Edit user-specific settings for the website, like font, theme, etc.</p>
<h3 id="2320-usersubmission">2.3.20. /user/submission</h3>
<p>Submit content for an event hosted by NovelAI.</p>
<h3 id="2321-usersubmissionevent">2.3.21. /user/submission/{event}</h3>
<p>Get the content your submitted for the event.</p>
<h3 id="2322-uservote-submissionevent">2.3.22. /user/vote-submission/{event}</h3>
<p>Vote, get your voting status, or delete your vote for an event.</p>
<h2 id="24-usersubscription">2.4. /user/subscription/</h2>
<h3 id="241-usersubscriptionbind">2.4.1. /user/subscription/bind</h3>
<p>Bind new subscription info from the payment processor to your account.</p>
<h3 id="242-usersubscriptionchange">2.4.2. /user/subscription/change</h3>
<p>Change the subscription tier to a new tier.</p>
<h2 id="25-ai">2.5. /ai/</h2>
<p>Image generation returns image(s) as PNG file(s) packed into a zip file using DEFLATE.</p>
<h3 id="251-aigenerate">2.5.1. /ai/generate</h3>
<p>Generate using one of the text AIs. For the input and output, see parameters.use_string. The most relevant generation options can be viewed in <a href="Generation-Settings.html#generation-options">Generation Settings</a>.</p>
<p>The input you send will be all the AI sees, which mean any context building needs to be done before sending the request. The maximum length (in tokens) you can send to the model depends on the selected model, your subscription tier, the generation length (parameters.max_length), if a module v1 is loaded, and if generate until sentence (parameters.generate_until_sentence) is true. For example, if the chosen model and your tier give you 2048 tokens of context, you need to remove the generation length (up to 150 tokens), 20 tokens if a module v1 is loaded, and 20 tokens if generate until sentence is true. Any additional token above this limit is truncated, starting from the top of context. If parameters.generate_until_sentence is true, the model will try to generate up to 20 tokens past the generation length, until a period is found.</p>
<p>For parameters.order, the sampling methods are <strong>ordered</strong>, the disabled ones are <strong>removed</strong>, and they are then arranged into an array with temperature =&gt; 0, top_k =&gt; 1 , top_p =&gt; 2, tfs =&gt; 3, top_a =&gt; 4, typical_p =&gt; 5, cfg =&gt; 6, top_g =&gt; 7, mirostat =&gt; 8</p>
<p>The number of lobprobs per token is set by parameters.num_logprobs. If this field is not set, no logprob will be sent with the response.</p>
<p>Stop sequences (parameters.stop_sequences) and Banned tokens (parameters.bad_words_ids) both expect a list of tokenized word(s).</p>
<p>Modules can be selected through parameters.prefix, and have a unique identifier, which you can usually find by exporting a scenario using this module and looking into the file. Official modules have a simple identifier (e.g. "general_crossgenre"), while custom modules have a longer one containing the model, location, and password of the encrypted module (e.g. "6B-v4:c6021..."). The full list of official modules can be found <a href="https://github.com/Aedial/novelai-api/blob/main/docs/source/novelai_api/Full_list_of_modules.md">here</a>. All custom modules are encrypted and stored server-side.</p>
<h3 id="252-aigenerate-prompt">2.5.2. /ai/generate-prompt</h3>
<p>Unknown, unused yet.</p>
<h3 id="253-aigenerate-stream">2.5.3. /ai/generate-stream</h3>
<p>Same as /ai/generate, but uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events">SSE</a> to transmit the response one token at a time.</p>
<h3 id="254-aiannotate-image">2.5.4. /ai/annotate-image</h3>
<p>Get the mask for ControlNet, from an image. The parameters should contain an "image" field with the base64-encoded PNG image to convert. For the model, Palette Swap is "hed", Form Lock is "midas", Scribbler is "fake_scribble", Building Control is "mlsd", and Landscaper is "uniformer".</p>
<h3 id="255-aigenerate-image">2.5.5. /ai/generate-image</h3>
<p>Generate an image using normal text to image, image to image, or inpainting. This endpoint is an image endpoint (<a href=".html">image.novelai.net</a>).</p>
<ul>
<li><p><strong>Parameters.width</strong>: Width of the image to generate.</p></li>
<li><p><strong>Parameters.height</strong>: Height of the image to generate.</p></li>
<li><p><strong>Parameters.n_samples</strong>: Number of images to return. The maximum value is 8 up to 360,448 px, 6 up to 409,600 px, 4 up to 1,310,720 px, 2 up to 1,572,864 px, and 1 up to the max size.</p></li>
<li><p><strong>Parameters.seed</strong>: Random seed to use for the image (between 0 and 4294967295), defaults to 0. Seed 0 means that a random seed will be chosen, but <strong>not set in the metadata</strong> (so giving a seed yourself is important). <strong>Note</strong>: When generating multiple images, each consecutive image adds 1 to the seed parameter. This means it can go beyond the limit of 4294967295, making it <strong>unreproducible</strong> with a single generation.</p></li>
<li><p><strong>Parameters.extra_noise_seed</strong>: Unknown, but seems to be fulfill the same role as Parameters.seed.</p></li>
<li><p><strong>Parameters.sampler</strong>: Refer to <a href="https://docs.novelai.net/image/sampling.html">sampling</a>. The full list of samplers is (some may not work due to being deprecated): "k_lms", "k_euler", "k_euler_ancestral", "k_heun", "plms", "ddim", "nai_smea", "nai_smea_dyn", "k_dpmpp_2m", "k_dpmpp_2s_ancestral", "k_dpmpp_sde", "k_dpm_2", "k_dpm_2_ancestral", "k_dpm_adaptive", "k_dpm_fast".</p></li>
<li><p><strong>Parameters.noise, Parameters.strength</strong>: Refer to <a href="https://docs.novelai.net/image/strengthnoise.html">strength and noise</a>.</p></li>
<li><p><strong>Parameters.steps, Parameters.scale</strong>: Refer to <a href="https://docs.novelai.net/image/stepsguidance.html">steps and scale</a>.</p></li>
<li><p><strong>Parameters.negative_prompt</strong>: Refer to <a href="https://docs.novelai.net/image/undesiredcontent.html">Undesired Content</a>.</p></li>
<li><p><strong>Parameters.sm, Parameters.sm_dyn</strong>: Enables SMEA and SMEA DYN, if True (SMEA needs to be enabled for SMEA DYN). Refer to <a href="https://docs.novelai.net/image/sampling.html#special-samplers-smea--smea-dyn">SMEA</a>.</p></li>
<li><p><strong>Parameters.image</strong>: Base64-encoded PNG image for Image to Image.</p></li>
<li><p><strong>Parameters.controlnet_condition</strong>: Base64-encoded PNG ControlNet mask retrieved from the /ai/annotate-image endpoint.</p></li>
<li><p><strong>Parameters.controlnet_model</strong>: Model to use for the ControlNet. Palette Swap is "hed", Form Lock is "depth", Scribbler is "scribble", Building Control is "mlsd", is Landscaper is "seg",</p></li>
<li><p><strong>Parameters.controlnet_strength</strong>: Controls how much influence the ControlNet has on the image.</p></li>
<li><p><strong>Parameters.dynamic_thresholding</strong>: Refer to <a href="https://docs.novelai.net/image/stepsguidance.html#decrisper">descrisper</a>. The technical details can be found on <a href="https://github.com/mcmonkeyprojects/sd-dynamic-thresholding">GitHub</a> and <a href="https://twitter.com/Birchlabs/status/1582165379832348672">Twitter</a>.</p></li>
<li><p><strong>Parameters.add_original_image</strong>: Refer to <a href="https://docs.novelai.net/image/inpaint.html#overlay-original-image">Overlay Original Image</a>.</p></li>
<li><p><strong>Parameters.mask</strong>: Base64-encoded black and white PNG image to use as a mask for inpainting. White is the area to inpaint and black is the rest.</p></li>
<li><p><strong>Parameters.cfg_rescale</strong>: Refer to <a href="https://docs.novelai.net/image/stepsguidance.html#prompt-guidance-rescale">rescale</a>.</p></li>
<li><p><strong>Parameters.noise_schedule</strong>: How much noise is added at each step. Can be "native", "karras", "exponential", or "polyexponential". Use native if you do not know what to use.</p></li>
<li><p><strong>Parameters.reference_image</strong>: Base64-encoded PNG image used for Vibe Transfer</p></li>
<li><p><strong>Parameters.reference_information_extracted</strong>: Refer to <a href="https://docs.novelai.net/image/vibetransfer.html#information-extracted">Vibe Transfer</a></p></li>
<li><p><strong>Parameters.reference_strength</strong>: Refer to <a href="https://docs.novelai.net/image/vibetransfer.html#reference-strength">Vibe Transfer</a></p></li>
<li><p><strong>Parameters.reference_image_multiple</strong>: list of reference_image for multi-vibe transfer</p></li>
<li><p><strong>Parameters.reference_information_extracted_multiple</strong>: list of reference_information_extracted for multi-vibe transfer</p></li>
<li><p><strong>Parameters.reference_strength_multiple</strong>: list of reference_strength for multi-vibe transfer</p></li>
</ul>
<p>More fields can be added in parameters, which will be present in the metadata of the image, like qualityToggle or ucPreset. These fields are mainly for the website to remember some state information when importing the image.</p>
<h3 id="256-aiupscale">2.5.6. /ai/upscale</h3>
<p>Upscale the provided PNG image.</p>
<h3 id="257-aiclassify">2.5.7. /ai/classify</h3>
<p>Unknown, unused yet.</p>
<h3 id="258-aigenerate-imagesuggest-tags">2.5.8. /ai/generate-image/suggest-tags</h3>
<p>Suggest tags with a certain confidence, considering how much the tag is used in the dataset. The confidence is between 0 and 1. This endpoint is an image endpoint (<a href=".html">image.novelai.net</a>).</p>
<h3 id="259-aigenerate-voice">2.5.9. /ai/generate-voice</h3>
<p>Generates an audio file reading the text sent. The endpoint accepts up to 1000 characters to read, any more being cut out.</p>
<p>There are 2 versions, selected via the "version" parameter. This parameter should be set to "v1" for TTS v1, or "v2" for TTS v2.</p>
<p>The voice choice is governed by the "voice" parameter for TTS v1, or the seed "parameter" for TTS v2. When using TTS v2, the "voice" parameter can be set to a default value (-1). Furthermore, the "seed" parameter allows for seedmix.</p>
<p>If the "opus" parameter is true, the returned audio file will be in WebM format, otherwise it will be in MP3 format.</p>
<h2 id="26-aimodule">2.6. /ai/module/</h2>
<h3 id="261-aimoduletrain">2.6.1. /ai/module/train</h3>
<p>Send a new module to the training queue.</p>
<h3 id="262-aimoduleall">2.6.2. /ai/module/all</h3>
<p>Get the modules currently in training or that finished training.</p>
<h3 id="263-aimoduleid">2.6.3. /ai/module/{id}</h3>
<p>Get/Delete a module currently in training or that finished training.</p>
<h3 id="264-aimodulebuy-training-steps">2.6.4. /ai/module/buy-training-steps</h3>
<p>Buy Anlas (steps) using your payment processor information.</p>
<h1 id="3-unofficial-api-resources">3. Unofficial API resources</h1>
<ul>
<li>C# - <a href="https://github.com/Draco18s/NovelAPI">https://github.com/Draco18s/NovelAPI</a></li>
<li>Golang - <a href="https://github.com/wbrown/novelai-research-tool">https://github.com/wbrown/novelai-research-tool</a> (more of a tool than an API, but uses the API)</li>
<li>Javascript - <a href="https://www.npmjs.com/package/@ibaraki-douji/novelai">https://www.npmjs.com/package/@ibaraki-douji/novelai</a>, <a href="https://github.com/Chanka0/novelapi">https://github.com/Chanka0/novelapi</a></li>
<li>Python - <a href="https://github.com/Aedial/novelai-api">https://github.com/Aedial/novelai-api</a></li>
</ul>

<!-- Javascript added by toc-css.lua to make TOC expandable on click -->
<script>

  const b = document.querySelector("body");
  const n = document.querySelector("nav");
  const buttonsize = 15;

  // click on "toc-title" to show TOC to the side
  document.querySelector("#toc-title").addEventListener("click", function(e) {
    if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize) {
      n.classList.toggle("navshown");
    } else {
      b.classList.toggle("paddingleft");
      n.classList.toggle("navside");
      n.classList.remove("navshown");
    };
  });

  // by default show TOC in large window
  window.onload = function() {
    if (window.innerWidth > 1000) {
      b.classList.add("paddingleft");
      n.classList.add("navside");
    };
  };

  // show/hide TOC on resize
  window.onresize = function () {
    // scrolling on mobile devices triggers resize, so we disable it altogether (for now)
    if (typeof window.orientation !== 'undefined') {
      return;
    };

    if (window.innerWidth > 1000) {
      b.classList.add("paddingleft");
      n.classList.add("navside");
    } else {
      b.classList.remove("paddingleft");
      n.classList.remove("navside");
    };
  };

  // show/hide subsections
  const allLis = document.querySelectorAll("nav li");

  for (const li of allLis) {
    li.addEventListener('click', function (e) {
      // show/hide subsection if arrow is clicked
      if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize
        && e.clientY < e.currentTarget.getBoundingClientRect().top + buttonsize) {

        li.classList.toggle('subShow');
        e.preventDefault();
      };

      // hide full nav if clicked outside
      if (e.currentTarget.getBoundingClientRect().left + 3*buttonsize < e.clientX) {
        n.classList.remove("navshown");
      };
    });

    li.classList.add('subShow');
  };

  // hide ToC if no overruling
  document.querySelector("nav ul").classList.add("toc-invisible");

  // show full nav on tab, hide full nav on escape
  document.addEventListener("keydown", function (e) {
    if (e.which === 27) {
      n.classList.remove("navshown");
      e.preventDefault();
    };
    if (e.which === 9) {
      n.classList.add("navshown");
      e.preventDefault();
    };
  });

  // insert key info
  n.insertAdjacentHTML("beforeend", "<span class='toc-invisible'> \
                                     <br/> \
                                     <p>Press <kbd>Tab</kbd> to show extended width TOC.</p> \
                                     <p>Presss <kbd>Esc</kbd> to go back to normal width.</p> \
                                     </span>");

  // hide full nav when clicked outside
  document.addEventListener("click", function(e) {
    if (n.classList.contains("navshown")) {
      if (!n.contains(e.target)) {
        n.classList.remove("navshown");
      };
    };
  });

</script>
</main>

</body>
</html>
