<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc-markdown-css-theme" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Lorebook Generation Tutorial</title>
  <style>
  :root {
    --solarized-base03:  #002b36;
    --solarized-base02:  #073642;
    --solarized-base01:  #586e75;
    --solarized-base00:  #657b83;
    --solarized-base0:   #839496;
    --solarized-base1:   #93a1a1;
    --solarized-base2:   #eee8d5;
    --solarized-base3:   #fdf6e3;
    --solarized-yellow:  #b58900;
    --solarized-orange:  #cb4b16;
    --solarized-red:     #dc322f;
    --solarized-magenta: #d33682;
    --solarized-violet:  #6c71c4;
    --solarized-blue:    #268bd2;
    --solarized-cyan:    #2aa198;
    --solarized-green:   #859900;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --solarized-base03: #fdf6e3;
      --solarized-base02: #eee8d5;
      --solarized-base01: #93a1a1;
      --solarized-base00: #839496;
      --solarized-base0:  #657b83;
      --solarized-base1:  #586e75;
      --solarized-base2:  #073642;
      --solarized-base3:  #002b36;
    }
  }

  pre, pre.numberSource {
    background: var(--solarized-base3);
    /* border: 1px solid var(--solarized-base2); */
    --color-code-highlight-bg: var(--solarized-base2);
  }
  pre code { color: var(--solarized-base00); }
  pre.numberSource > code.sourceCode > span > a:first-child::before {
    color: var(--solarized-base1);
  }
  code span.kw { color: var(--solarized-green);  font-weight: normal; font-style: normal; } /* Keyword */
  code span.dt { color: var(--solarized-yellow); font-weight: normal; font-style: normal; } /* DataType */
  code span.dv { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* DecVal */
  code span.bn { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* BaseN */
  code span.fl { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* Float */
  code span.ch { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* Char */
  code span.st { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* String */
  code span.co { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* Comment */
  code span.ot { color: var(--solarized-blue);   font-weight: normal; font-style: normal; } /* Other */
  code span.al { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* Alert */
  code span.fu { color: var(--solarized-blue);   font-weight: normal; font-style: normal; } /* Function */
  code span.er { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* Error */
  code span.wa { color: var(--solarized-orange); font-weight: normal; font-style: italic; } /* Warning */
  code span.cn { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* Constant */
  code span.sc { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* SpecialChar */
  code span.vs { color: var(--solarized-cyan);   font-weight: normal; font-style: normal; } /* VerbatimString */
  code span.ss { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* SpecialString */
  code span.im { color: var(--solarized-base00); font-weight: normal; font-style: normal; } /* Import */
  code span.va { color: var(--solarized-blue);   font-weight: normal; font-style: normal; } /* Variable */
  code span.cf { color: var(--solarized-green);  font-weight: normal; font-style: normal; } /* ControlFlow */
  code span.op { color: var(--solarized-green);  font-weight: normal; font-style: normal; } /* Operator */
  code span.bu { color: var(--solarized-base00); font-weight: normal; font-style: normal; } /* BuiltIn */
  code span.ex { color: var(--solarized-base00); font-weight: normal; font-style: normal; } /* Extension */
  code span.pp { color: var(--solarized-orange); font-weight: normal; font-style: normal; } /* Preprocessor */
  code span.at { color: var(--solarized-base00); font-weight: normal; font-style: normal; } /* Attribute */
  code span.do { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* Documentation */
  code span.an { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* Annotation */
  code span.cv { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* CommentVar */
  code span.in { color: var(--solarized-base1);  font-weight: normal; font-style: italic; } /* Information */
  a.sourceLine::before { text-decoration: none; }

  /* pandoc diff mode */
  code.diff span.kw { color: var(--solarized-yellow); font-weight: normal; font-style: normal; } /* --- lines */
  code.diff span.dt { color: var(--solarized-blue);   font-weight: normal; font-style: normal; } /* +++ lines, @@ ... @@ lines */
  code.diff span.st { color: var(--solarized-red);    font-weight: normal; font-style: normal; } /* - lines */
  code.diff span.va { color: var(--solarized-green);  font-weight: normal; font-style: normal; } /* + lines */

  </style>
  <style>

  /* ----- Global settings ----------------------------------------------- {{{ */

  :root {
    /* --- Colors --- */
    --background-color: #161313;

    --color-text: #f7f5f2;
    --color-text-secondary: #9d9b99;
    --color-link: #bc805d;
    --color-sidenote: #b4b2af;

    --highlight-red: #660000;
    --highlight-yellow: #7f6000;
    --highlight-green: #274e13;
    --highlight-blue: #1c4587;
    --highlight-purple: #351c75;

    --color-inline-code: #f7f5f2;
    --color-inline-code-bg: #242121;

    --color-border: #393635;
    --color-border-heavy: #524f4d;

    --color-table-heading: #242121;

    /* --- Text --- */

    --font-family-prose: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;
    --font-family-heading: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;
    --font-family-code: Menlo, monospace;
    --side-note-number-font-family: var(--font-family-prose);

    --line-height: 26px;
    --font-size: 17px;

    --inline-code-font-size: 15px;
    --code-block-font-size: 14px;
    --code-block-side-padding: 8px;
    --line-numbers-font-size: 12px;

    --tight-code-line-height: 18px;
    --tight-code-padding-top: 5px;

    --side-note-line-height: 20px;
    --side-note-font-size: 13px;
    --side-note-code-font-size: 13px;
    --side-note-baseline-offset: 4px;
    --side-note-sup-offset: -6px;
    --side-note-number-hang-left: -6px;
    --side-note-text-indent: -9px;

    --heading-font-weight: 500;

    --title-font-size: 42px;
    --title-code-font-size: 40px;
    --title-line-height: 48px;
    --title-margin-top: 92px;

    --h1-font-size: 32px;
    --h1-code-font-size: 29px;
    --h1-line-height: 36px;
    --h1-word-spacing: 1px;
    --h1-margin-top: 30px;
    --h1-margin-bottom: 12px;

    --h2-font-size: 22px;
    --h2-code-font-size: 20px;
    --h2-line-height: 28px;
    --h2-word-spacing: 0.5px;
    --h2-margin-top: 18px;
    --h2-margin-bottom: 6px;

    --ul-indent-size: 23px;
    --ol-indent-size: 19px;
    --ol-li-padding-left: 4px;

    --hr-margin-top: 18px;
    --hr-margin-bottom: calc(var(--line-height) - var(--hr-margin-top) - 1px);

    --extra-wide-scale-factor: 1.5;

    --figcaption-line-height: 21px;
    --figcaption-font-size: 14px;
    --figcaption-code-font-size: 13px;
    --figcaption-gap: 6px;
    --captioned-figure-gap: 10px;

    --table-line-height: 21px;
    --table-font-size: 14px;
    --table-code-font-size: 13px;

    --nav-toc-font-size: 12px;
    --nav-toc-code-font-size: 12px;
    --nav-toc-indent: 15px;
    --nav-toc-baseline-offset: 2px;

    /* --- Layout --- */

    --main-width: 745px * 2;
    /* The name doesn't indicate it, but this variable actually specifies an
     * effective minimum width. (It didn't previously behave this way, but the
     * change to do so was made in a backwards-compatible way, so the variable
     * was not renamed.)
     **/
    --main-width-narrow: 550px;
    --side-note-max-width: 300px;

  }


  *, *:after, *:before {
    box-sizing: border-box;
    margin: 0;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  html {
    /* https://github.com/edwardtufte/tufte-css/issues/81#issuecomment-261953409 */
    -webkit-text-size-adjust: 100%;
  }

  body {
    font-family: var(--font-family-prose);
    color: var(--color-text);
    font-size: var(--font-size);
    line-height: var(--line-height);
    -webkit-font-variant-ligatures: no-common-ligatures;
    font-variant-ligatures: no-common-ligatures;

    /* Safari-only right now (macOS, iOS) but looks so good. */
    hanging-punctuation: first;

    margin: 0;
    padding: 0;
    padding-top: var(--title-margin-top);
    width: 100%;

    background-color: var(--background-color);
  }

  @media print {
    body {
      background-color: initial;
    }
  }

  /* }}} */
  /* ----- Utility classes -----------------------------------------------  {{{ */
  .only-light-mode {
    display: inherit;
  }
  .only-dark-mode {
    display: none;
  }

  @media (prefers-color-scheme: dark) {
    .only-light-mode {
      display: none;
    }
    .only-dark-mode {
      display: inherit;
    }
  }
  /* }}} */
  /* ----- Side notes and margin notes ----------------------------------- {{{ */
  /* --- Side note text and numbering --- {{{ */

  .sidenote,
  .marginnote {
    color: var(--color-sidenote);

    font-size: var(--side-note-font-size);
    line-height: var(--side-note-line-height);
    vertical-align: baseline;

    /* Align first baseline to body. */
    margin-top: var(--side-note-baseline-offset);
  }

  .sidenote code,
  .marginnote code {
    color: var(--color-sidenote);
  }

  main {
    counter-reset: sidenote-counter;
  }

  .sidenote-number {
    counter-increment: sidenote-counter;
  }

  .sidenote-number:after,
  .sidenote:before {
    content: counter(sidenote-counter);
    position: relative;
  }

  nav#TOC label,
  label.margin-toggle:not(.sidenote-number),
  .sidenote-number:after,
  .sidenote:before,
  .footnote-ref sup,
  sup {
    font-size: var(--side-note-font-size);
    font-weight: 700;
    font-family: var(--side-note-number-font-family);
    -webkit-font-feature-settings: "tnum" 1;
    font-feature-settings: "tnum" 1;

    /* Mimic 'vertical-align: super' (browser style for sup tag)
     * without causing a gap in our text's implicit grid. */
    vertical-align: baseline;
    position: relative;
    top: var(--side-note-sup-offset);
  }

  sup {
    font-weight: inherit;
  }

  /* Make the superscript hang. */
  .sidenote:before { left: var(--side-note-number-hang-left); }
  /* Get first first column of first row to line up with other rows. */
  .sidenote { text-indent: var(--side-note-text-indent); }

  /*}}} */
  /* --- Side note input controls --- {{{ */

  input.margin-toggle {
      display: none;
  }
  label.margin-toggle:not(.sidenote-number) {
      display: none;
  }
  label.sidenote-number {
      display: inline;
  }

  /* Unfortunately, variables aren't in scope here.
   * See calculations in Horizontal layouting.
   */
  @media screen and (max-width: calc(26px + 550px + 26px + 169px + 26px - 1px)) {
    .margin-toggle:checked + .sidenote,
    .margin-toggle:checked + .marginnote {
      margin-top: var(--side-note-line-height);
      vertical-align: baseline;
    }

    label.margin-toggle {
      color: var(--color-link);
    }

    label.margin-toggle:not(.sidenote-number) {
      display: inline;
    }

    label {
      cursor: pointer;
    }
  }

  /* }}} */
  /* }}} */
  /* ----- Headings ------------------------------------------------------ {{{ */

  h1, h2 {
    font-family: var(--font-family-heading);
    font-weight: var(--heading-font-weight);
  }

  h4, h5, h6 {
    font-weight: normal;
  }

  h1.title {
    margin-top: var(--line-height);
    margin-bottom: var(--line-height);
    font-size: var(--title-font-size);
    line-height: var(--title-line-height);
  }

  h1.title code {
    font-size: var(--title-code-font-size);
  }

  h1:not(.title) {
    font-size: var(--h1-font-size);
    line-height: var(--h1-line-height);
    word-spacing: var(--h1-word-spacing);

    margin-top: var(--h1-margin-top);
    margin-bottom: var(--h1-margin-bottom);
  }

  h1:not(.title) code {
    font-size: var(--h1-code-font-size);
  }

  h2 {
    font-size: var(--h2-font-size);
    line-height: var(--h2-line-height);
    word-spacing: var(--h2-word-spacing);

    margin-top: var(--h2-margin-top);
    margin-bottom: var(--h2-margin-bottom);
  }

  h2 code {
    font-size: var(--h2-code-font-size);
  }

  h3 {
    font-size: var(--font-size);
    line-height: var(--line-height);
    font-weight: bold;
  }

  h1:not(.title) + *, h1:not(.title) + p { margin-top: var(--h1-margin-bottom); }
  h2 + *, h2 + p                         { margin-top: var(--h2-margin-bottom); }
  h3 + *, h3 + p                         { margin-top: 0; }

  /* }}} */
  /* ----- Prose --------------------------------------------------------- {{{ */

  p, main > ul, main > ol, div.sourceCode, main > pre, img, table {
    margin-top: var(--line-height);
    margin-bottom: var(--line-height)
  }

  ol {
    margin-left: var(--ol-indent-size);
  }

  ul.task-list {
    list-style: none;
    margin-left: var(--ul-indent-size);
  }

  ul.task-list > li {
    position: relative;
  }

  ul.task-list > li > input[type="checkbox"] {
    position: absolute;
    left: calc(-1 * var(--ul-indent-size));
    height: var(--line-height);
  }

  ol > li {
    padding-left: var(--ol-li-padding-left);
  }

  ol                         { list-style-type: decimal; }
  ol ol                      { list-style-type: lower-alpha; }
  ol ol ol                   { list-style-type: lower-roman; }
  ol ol ol ol                { list-style-type: decimal; }
  ol ol ol ol ol             { list-style-type: lower-alpha; }
  ol ol ol ol ol ol          { list-style-type: lower-roman; }
  ol ol ol ol ol ol ol       { list-style-type: decimal; }
  ol ol ol ol ol ol ol ol    { list-style-type: lower-alpha; }
  ol ol ol ol ol ol ol ol ol { list-style-type: lower-roman; }

  ul                         { list-style-type: disc; }
  ul ul                      { list-style-type: circle; }
  ul ul ul                   { list-style-type: square; }
  ul ul ul ul                { list-style-type: disc; }
  ul ul ul ul ul             { list-style-type: circle; }
  ul ul ul ul ul ul          { list-style-type: square; }
  ul ul ul ul ul ul ul       { list-style-type: disc; }
  ul ul ul ul ul ul ul ul    { list-style-type: circle; }
  ul ul ul ul ul ul ul ul ul { list-style-type: square; }

  blockquote {
    border-left: 1px solid var(--color-text-secondary);
    padding-left: 1.5rem;

    font-style: italic;
  }

  blockquote > p {
    margin-top: 0;
  }

  blockquote em, blockquote i, blockquote .sidenote-wrapper {
    font-style: normal;
  }

  hr {
    margin-top: var(--hr-margin-top);
    margin-bottom: var(--hr-margin-bottom);
    border-style: solid;
    color: var(--color-border-heavy);
    border-width: 1px 0 0;
  }

  a code, a:link code, a:visited code,
  a, a:link, a:visited {
    color: var(--color-link);
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  span.mark, mark {
    /* Reset browser styles */
    color: inherit;

    padding: 2px 0 1px;
  }
  span.mark.red,    mark.red    { background-color: var(--highlight-red);    }
  span.mark.yellow, mark.yellow { background-color: var(--highlight-yellow); }
  span.mark.green,  mark.green  { background-color: var(--highlight-green);  }
  span.mark.blue,   mark.blue   { background-color: var(--highlight-blue);   }
  span.mark.purple, mark.purple { background-color: var(--highlight-purple); }

  .subtitle {
    margin-top: 0;
  }
  .author, .date {
    margin-top: 0;
    margin-bottom: 0;
  }
  .signoff {
    margin-top: calc(4 * var(--line-height));
    margin-bottom: calc(4 * var(--line-height));
  }

  /* Pandoc utility classes */
  span.smallcaps{ font-variant: small-caps; }
  span.underline{ text-decoration: underline; }

  .katex-display {
    background: var(--background-color);
    transform: translateZ(0px);
  }

  @media print {
    .katex-display {
      background-color: initial;
    }
  }

  /* }}} */
  /* ----- Code ---------------------------------------------------------- {{{ */

  /* Pandoc code blocks with a language look like div.sourceCode > pre.sourceCode
   * Otherwise, it's just a pre (without .sourceCode)
   *
   * The 'code' element is tricky because it's used for inline code and code in a
   * pre.
   */

  code {
    font-family: var(--font-family-code);

    word-spacing: normal;

    /* Only for inline code */
    color: var(--color-inline-code);
    background-color: var(--color-inline-code-bg);
    font-size: var(--inline-code-font-size);
    margin: 0;
    padding: 2px 0 1px;
    border: 1px solid var(--color-border);
    border-radius: 1px;
  }

  .sidenote code,
  .marginnote code {
    font-size: var(--side-note-code-font-size);
  }

  pre code {
    /* Reset some changes meant to be inline-only */
    color: inherit;
    background-color: inherit;
    font-size: var(--code-block-font-size);
    line-height: var(--line-height);
    margin: initial;
    padding: initial;
    border: initial;
    border-radius: initial;
  }

  pre > code {
    position: relative; /* For line highlights */
    display: inline-block;
    min-width: 100%;
    z-index: 1;

    white-space: pre-wrap;

    padding: 0 var(--code-block-side-padding);
  }

  code.sourceCode::selection {
    /* Prevent bug where far right edge of text box shows as selected. */
    background: transparent;
  }

  .wide > pre, .wide > div.sourceCode {
    /* Put this in front of the table of contents */
    transform: translateZ(0px);
  }

  .wide pre > code {
    white-space: pre;
  }

  pre.numberSource code {
    counter-reset: source-line 0;
  }

  pre > code.sourceCode > span {
    line-height: var(--line-height);

    display: inline-block;
    min-width: 100%;
  }

  div.sourceCode {
    /* Need to make room for line numbers (even if they're not going to be used).
     * Width doesn't matter, just needs to be big enough to hold the largest line
     * number. */
    --line-numbers-width: calc(4 * var(--line-numbers-font-size));
    --line-numbers-negative-width: calc(-1 * var(--line-numbers-width));
    margin-left: var(--line-numbers-negative-width);
  }
  div.sourceCode > pre {
    margin-left: var(--line-numbers-width);
  }
  pre.numberSource > code.sourceCode > span {
    counter-increment: source-line;
    padding-left: var(--line-numbers-width);
    text-indent: var(--line-numbers-negative-width);
    position: relative;
    left: var(--line-numbers-negative-width);
  }
  pre.numberSource > code.sourceCode > span > a:first-child::before {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

    content: counter(source-line);
    font-size: var(--line-numbers-font-size);
    text-decoration: none;

    position: relative;
    text-align: right;
    display: inline-block;

    padding: 0 calc(2 * var(--code-block-side-padding));
    width: var(--line-numbers-width);
  }
  pre > code.sourceCode > span > a:first-child::before:hover {
    text-decoration: underline;
  }

  /* Utility class for code blocks that contain things like box drawing characters, where it's nice for things to touch. */
  .tight-code pre,
  pre.tight-code {
    padding-top: var(--tight-code-padding-top);
  }

  pre.tight-code code,
  .tight-code pre code,
  .tight-code pre > code.sourceCode > span,
  pre.tight-code > code.sourceCode > span {
    line-height: var(--tight-code-line-height);
  }

  /* --- Code line highlights --- {{{ */
  /* I used some code I contributed to owickstrom's pandoc-emphasize-code[1] as
   * inspiration for these changes.
   *
   * The novel part is using :nth-of-type(...) selectors and CSS classes, instead
   * of needing a pandoc filter. This means that we can stick with pandoc's
   * default syntax highlighter, and not need to requirer JavaScript for syntax
   * highlighting. It has the obvious limitation that it places a fixed limit on
   * lines that can be highlighted, but these additional CSS styles are easy
   * enough to write, so anyone who needs more lines can write their own
   * stylesheet and include it to add more after the fact.
   *
   * [1] https://github.com/owickstrom/pandoc-emphasize-code/pull/3
   */

  pre > code.sourceCode > span::after {
    position: absolute;
    background-color: var(--color-code-highlight-bg);
    z-index: -1;
    left: calc(var(--line-numbers-width) - var(--code-block-side-padding));
    right: calc(var(--line-numbers-negative-width) - var(--code-block-side-padding));
    top: 0;
    height: 100%;
  }

  pre.hl-1  > code.sourceCode > span:nth-of-type(1)::after  { content: ""; }
  pre.hl-2  > code.sourceCode > span:nth-of-type(2)::after  { content: ""; }
  pre.hl-3  > code.sourceCode > span:nth-of-type(3)::after  { content: ""; }
  pre.hl-4  > code.sourceCode > span:nth-of-type(4)::after  { content: ""; }
  pre.hl-5  > code.sourceCode > span:nth-of-type(5)::after  { content: ""; }
  pre.hl-6  > code.sourceCode > span:nth-of-type(6)::after  { content: ""; }
  pre.hl-7  > code.sourceCode > span:nth-of-type(7)::after  { content: ""; }
  pre.hl-8  > code.sourceCode > span:nth-of-type(8)::after  { content: ""; }
  pre.hl-9  > code.sourceCode > span:nth-of-type(9)::after  { content: ""; }
  pre.hl-10 > code.sourceCode > span:nth-of-type(10)::after { content: ""; }
  pre.hl-11 > code.sourceCode > span:nth-of-type(11)::after { content: ""; }
  pre.hl-12 > code.sourceCode > span:nth-of-type(12)::after { content: ""; }
  pre.hl-13 > code.sourceCode > span:nth-of-type(13)::after { content: ""; }
  pre.hl-14 > code.sourceCode > span:nth-of-type(14)::after { content: ""; }
  pre.hl-15 > code.sourceCode > span:nth-of-type(15)::after { content: ""; }
  pre.hl-16 > code.sourceCode > span:nth-of-type(16)::after { content: ""; }
  pre.hl-17 > code.sourceCode > span:nth-of-type(17)::after { content: ""; }
  pre.hl-18 > code.sourceCode > span:nth-of-type(18)::after { content: ""; }
  pre.hl-19 > code.sourceCode > span:nth-of-type(19)::after { content: ""; }
  pre.hl-20 > code.sourceCode > span:nth-of-type(20)::after { content: ""; }
  pre.hl-21 > code.sourceCode > span:nth-of-type(21)::after { content: ""; }
  pre.hl-22 > code.sourceCode > span:nth-of-type(22)::after { content: ""; }
  pre.hl-23 > code.sourceCode > span:nth-of-type(23)::after { content: ""; }
  pre.hl-24 > code.sourceCode > span:nth-of-type(24)::after { content: ""; }
  pre.hl-25 > code.sourceCode > span:nth-of-type(25)::after { content: ""; }
  pre.hl-26 > code.sourceCode > span:nth-of-type(26)::after { content: ""; }
  pre.hl-27 > code.sourceCode > span:nth-of-type(27)::after { content: ""; }
  pre.hl-28 > code.sourceCode > span:nth-of-type(28)::after { content: ""; }
  pre.hl-29 > code.sourceCode > span:nth-of-type(29)::after { content: ""; }
  pre.hl-30 > code.sourceCode > span:nth-of-type(30)::after { content: ""; }
  pre.hl-31 > code.sourceCode > span:nth-of-type(31)::after { content: ""; }
  pre.hl-32 > code.sourceCode > span:nth-of-type(32)::after { content: ""; }
  pre.hl-33 > code.sourceCode > span:nth-of-type(33)::after { content: ""; }
  pre.hl-34 > code.sourceCode > span:nth-of-type(34)::after { content: ""; }
  pre.hl-35 > code.sourceCode > span:nth-of-type(35)::after { content: ""; }
  pre.hl-36 > code.sourceCode > span:nth-of-type(36)::after { content: ""; }
  pre.hl-37 > code.sourceCode > span:nth-of-type(37)::after { content: ""; }
  pre.hl-38 > code.sourceCode > span:nth-of-type(38)::after { content: ""; }
  pre.hl-39 > code.sourceCode > span:nth-of-type(39)::after { content: ""; }
  pre.hl-40 > code.sourceCode > span:nth-of-type(40)::after { content: ""; }

  /* }}} */

  /* }}} */
  /* ----- Images and figures -------------------------------------------- {{{ */

  /* There's only a figure if there's a caption. Tighten things up. */
  figure {
    margin-bottom: var(--captioned-figure-gap);
  }

  figure + p {
    margin-top: var(--captioned-figure-gap);
  }

  figure > img, figure > pre, figure > div.sourceCode {
    margin-bottom: var(--figcaption-gap);
  }

  img {
    display: block;
  }

  .wide img {
    /* Put this in front of the table of contents */
    transform: translateZ(0px);
  }

  figcaption {
    font-size: var(--figcaption-font-size);
    line-height: var(--figcaption-line-height);
    font-style: italic;
    text-align: center;
    color: var(--color-text-secondary);
  }

  .left-align-caption figcaption {
    text-align: left;
  }

  figcaption code {
    font-size: var(--figcaption-code-font-size);
  }

  /* }}} */
  /* ----- Tables -------------------------------------------------------- {{{ */

  table {
    -webkit-font-feature-settings: "tnum" 1;
    font-feature-settings: "tnum" 1;

    font-size: var(--table-font-size);
    line-height: var(--table-line-height);

    border-spacing: 0;
    border-collapse: collapse;
    border: 1px solid var(--color-border-heavy);

    width: 100%;

    /* Solid background to occlude table of contents */
    background-color: var(--background-color);
  }

  @media print {
    table {
      background-color: initial;
    }
  }

  table code {
    font-size: var(--table-code-font-size);
  }

  table pre code {
    font-size: inherit;
  }

  .wide table {
    /* Put this in front of the table of contents */
    transform: translateZ(0px);
  }

  table td, table th {
    border: 1px solid var(--color-border-heavy);
    padding: 5px 8px;
    min-width: 100px;
  }
  table th {
    background-color: var(--color-table-heading);
  }

  table > caption {
    caption-side: bottom;
    margin-top: var(--figcaption-gap);
    margin-bottom: calc(var(--captioned-figure-gap) - var(--line-height));
    font-size: var(--figcaption-font-size);
    line-height: var(--figcaption-line-height);
    font-style: italic;
    text-align: center;
    color: var(--color-text-secondary);
  }

  .left-align-caption table > caption {
    text-align: left;
  }

  table > caption code {
    font-size: var(--figcaption-code-font-size);
  }

  /* --- Notes are just single cell tables --- */

  .note table {
    font-size: inherit;
    line-height: inherit;
  }
  .note table, .note td {
    border: none;
  }

  .note.red    td { background: var(--highlight-red); }
  .note.yellow td { background: var(--highlight-yellow); }
  .note.green  td { background: var(--highlight-green); }
  .note.blue   td { background: var(--highlight-blue); }
  .note.purple td { background: var(--highlight-purple); }

  /* }}} */
  /* ----- Table of contents --------------------------------------------- {{{ */

  .date.before-toc {
    padding-bottom: var(--line-height);
  }

  nav#TOC label {
    color: var(--color-link);
    cursor: pointer;
  }

  nav#TOC code,
  nav#TOC a,
  nav#TOD a:link,
  nav#TOD a:visited {
    color: var(--color-text-secondary);
  }

  header {
    margin-bottom: var(--line-height);
  }

  .date.before-toc {
    padding-bottom: initial;
  }

  nav#TOC code {
    font-size: var(--nav-toc-code-font-size);
  }

  nav#TOC a:hover,
  nav#TOC a:hover code {
    text-decoration: none;
    color: var(--color-link);
  }

  /* }}} */
  /* ----- Horizontal layouting (main, side notes, extra-wide) ----------- {{{ */

  .sidenote,
  .marginnote {
    float: right;
    clear: right;
    position: relative;

    width: var(--computed-width);
    max-width: var(--side-note-max-width);
    margin-right: calc(-1 * min(var(--computed-width), var(--side-note-max-width)) - var(--margin-left));
  }

  /* --- Side notes and table of contents always visible --- {{{ */

  /* Unfortunately, variables aren't in scope here.
   * 745px = --main-width
   * 52px = 2 * --line-height
   * 206px = side note min width
   */
  @media screen and (min-width: calc(745px + 2 * (52px + 206px + 52px))) {
    header,
    main,
    footer {
      max-width: var(--main-width);
    }

    header,
    main,
    footer {
      margin-left: auto;
      margin-right: auto;
    }

    .sidenote,
    .marginnote {
      --margin-left: calc(2 * var(--line-height));
      --margin-right: var(--margin-left);
      --computed-width: calc((100vw - 100%) / 2 - var(--margin-right) - var(--margin-left));
    }

    .wide {
      width: 100%;
      overflow-x: auto;
    }

    .wide.extra-wide {
      margin-left: calc((1 - var(--extra-wide-scale-factor)) / 2 * 100%);
      width: calc(var(--extra-wide-scale-factor) * 100%);
    }

    .wide.full-width {
      margin-left: calc(var(--line-height) - ((100vw - var(--main-width)) / 2));
      width: calc(100vw - 2 * var(--line-height));
    }

    .wide.extra-wide figcaption,
    .wide.extra-wide table > caption {
      margin-left: calc(((var(--extra-wide-scale-factor) - 1) / 2) * var(--main-width));
      max-width: var(--main-width);
      margin-right: calc(100% - var(--main-width) - (((var(--extra-wide-scale-factor) - 1) / 2) * var(--main-width)));
    }

    .wide.full-width figcaption,
    .wide.full-width table > caption {
      margin-left: calc((100vw - var(--main-width)) / 2 - var(--line-height));
      max-width: var(--main-width);
      margin-right: calc(100% - var(--main-width) - ((100vw - var(--main-width)) / 2 - var(--line-height)));
    }
  }

  /* }}} */
  /* --- Side notes visibile, table of contents collapsed, double-wide margins --- {{{ */

  /* Unfortunately, variables aren't in scope here.
   * 745px = --main-width
   * 52px = 2 * --line-height
   * 206px = side note min width
   */
  @media screen and (min-width: calc(52px + 745px + 52px + 206px + 52px)) and (max-width: calc(745px + 2 * (52px + 206px + 52px) - 1px)) {
    .sidenote,
    .marginnote {
      --margin-left: calc(2 * var(--line-height));
      --margin-right: var(--margin-left);
      --computed-width: calc(100vw - var(--main-width) - calc(2 * var(--line-height)) - var(--margin-right) - var(--margin-left));
    }

    .wide {
      width: 100%;
      overflow-x: auto;
      overflow-y: hidden;
    }

    .wide.extra-wide {
      margin-left: calc(-1 * var(--line-height));
      width: calc(100vw - 2 * var(--line-height));
      max-width: calc(var(--extra-wide-scale-factor) * var(--main-width));
    }

    .wide.full-width {
      margin-left: calc(-1 * var(--line-height));
      width: calc(100vw - 2 * var(--line-height));
      max-width: calc(100vw - 2 * var(--line-height));
    }

    .wide.extra-wide .katex-display,
    .wide.full-width .katex-display {
      padding-left: var(--line-height);
      padding-right: var(--line-height);
    }

    .wide.extra-wide .katex-display,
    .wide.extra-wide .katex-display > .katex,
    .wide.full-width .katex-display,
    .wide.full-width .katex-display > .katex {
      text-align: left;
    }

    .wide.extra-wide figcaption,
    .wide.extra-wide table > caption,
    .wide.full-width figcaption,
    .wide.full-width table > caption {
      text-align: left;
      margin-left: var(--line-height);
      max-width: var(--main-width);
    }
  }

  /* }}} */
  /* --- Side notes visibile, table of contents collapsed --- {{{ */

  /* Unfortunately, variables aren't in scope here.
   * 550px = --main-width-narrow
   * 26px = --line-height
   * 169px = side note min width narrow
   */
  @media screen and (min-width: calc(26px + 550px + 26px + 169px + 26px)) and (max-width: calc(52px + 745px + 52px + 206px + 52px - 1px)) {
    .sidenote,
    .marginnote {
      --margin-left: var(--line-height);
      --margin-right: var(--line-height);
      --computed-width: calc(100vw - var(--main-width-narrow) - var(--line-height) - var(--margin-right) - var(--margin-left));
    }

    .wide {
      width: var(--main-width);
      overflow-x: auto;
      overflow-y: hidden;
    }

    .wide .katex-display,
    .wide .katex-display > .katex {
      text-align: left;
    }

    .wide figcaption,
    .wide table > caption {
      text-align: left;
      max-width: var(--main-width-narrow);
    }

    .wide.extra-wide,
    .wide.full-width {
      width: calc(100vw - 2 * var(--line-height));
    }
  }

  /* }}} */
  /* --- Side notes and table of contents collapsed --- {{{ */

  /* Unfortunately, variables aren't in scope here.
   * See calculations above.
   */
  @media screen and (max-width: calc(26px + 550px + 26px + 169px + 26px - 1px)) {
    .sidenote,
    .marginnote {
      display: none;
    }

    .wide {
      width: 100%;
      overflow-x: auto;
      overflow-y: hidden;
    }

    .wide .katex-display,
    .wide .katex-display > .katex {
      text-align: left;
    }

    .wide figcaption,
    .wide table > caption {
      text-align: left;
      max-width: calc(100vw - 2 * var(--line-height));
    }
  }

  /* }}} */
  /* --- Paged media (print styles) --- {{{ */
  @page {
    size: letter;
    margin: 0.5in;
    /* To make room for line numbers in left margin. */
    margin-left: 0.25in;
  }

  @media print {
    :root {
      --line-height: 18px;
      --font-size: 12px;

      --inline-code-font-size: 11px;
      --code-block-font-size: 10px;
      --code-block-side-padding: 6px;
      --line-numbers-font-size: 8.5px;

      --tight-code-line-height: 12.5px;
      --tight-code-padding-top: 2px;

      --side-note-line-height: 14px;
      --side-note-font-size: 9px;
      --side-note-code-font-size: 9px;
      --side-note-baseline-offset: 3px;
      --side-note-sup-offset: -4px;
      --side-note-number-hang-left: -4px;
      --side-note-text-indent: -6.5px;

      --title-font-size: 30px;
      --title-code-font-size: 29px;
      --title-line-height: 37px;
      --title-margin-top: 71px;

      --h1-font-size: 22px;
      --h1-code-font-size: 20px;
      --h1-line-height: 28px;
      --h1-word-spacing: 0.5px;
      --h1-margin-top: 18px;
      --h1-margin-bottom: 6px;

      --h2-font-size: 16.5px;
      --h2-code-font-size: 15px;
      --h2-line-height: 22px;
      --h2-word-spacing: 0px;
      --h2-margin-top: 14px;
      --h2-margin-bottom: 4.5px;

      --ul-indent-size: 18px;
      --ol-indent-size: 14px;

      --hr-margin-top: 14px;

      --figcaption-line-height: 16px;
      --figcaption-font-size: 10px;
      --figcaption-code-font-size: 9.5px;
      --figcaption-gap: 4.5px;
      --captioned-figure-gap: 7.5px;

      --table-line-height: 16px;
      --table-font-size: 10px;
      --table-code-font-size: 9.5px;

      --nav-toc-font-size: 8.5px;
      --nav-toc-code-font-size: 8.5px;
    }

    body {
      padding-top: 0;
      /* To make room for line numbers in left margin. */
      padding-left: 0.25in;
    }

    .sidenote,
    .marginnote {
      width: 2in;
      margin-right: -2.25in;
    }

    .wide {
      width: 7.5in;
      overflow-x: hidden;
      overflow-y: hidden;
    }

    .wide .katex-display,
    .wide .katex-display > .katex {
      text-align: left;
    }

    .wide figcaption,
    .wide table > caption {
      text-align: left;
      width: 5.25in;
    }

    .wide pre > code {
      white-space: pre-wrap;
    }
  }

  h1, h2, h3 {
    page-break-after: avoid;
  }

  table, figure, pre, img {
    page-break-inside: avoid;
  }
  /* }}} */
  /* }}} */

  /* vim:fdm=marker
   */

  </style>
  <!-- CSS added by filter 'toc-css.lua' for TOC hovering to the side -->
  <!-- TODO: try doing sometthing in px instead of cm to make it more device independent -->
  <style>
  body {
    padding-left: 1.5cm;
    padding-right: 1cm;
    transition: 0.5s;
  }
  nav {
    width: 1cm;
    margin-left: -1.5cm;
    color: grey;
    transition: 0.5s;
    float: left;
    position: fixed;
    top: 0;
    bottom: 0;
    white-space: nowrap;
    overflow: hidden;
    overflow-y: scroll;
    transition: 0.5s;
    z-index: 10;
  }
  nav::-webkit-scrollbar {
    display: none;
  }
  nav a, nav a:visited {
    color: grey;
  }
  nav h2:before {
    content: "≡ ";
    font-size: 150%;
  }
  nav h2:after {
    content: " ◂";
  }
  nav > ul {
    padding-left: 1em;
  }
  nav li {
    margin-left: 1em;
    padding-left: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  nav ul {
    padding-left: 1em;
    margin-left: 0;
  }
  nav li > a:not(:only-child):before {
    content: "▸ ";
  }
  nav li li li {
    font-size: smaller;
  }
  nav ul li ul  {
    visibility: hidden;
    display: none;
    margin-top: 0.2em;
    margin-bottom: 0.2em;
    transition: 0.5s;
  }
  .paddingleft {
    padding-left: 11cm;
    transition: 0.5s;
  }
  .navside {
    width: 10cm;
    margin-left: -10.5cm;
    padding-right: 1em;
    transition: 0.5s;
  }
  .navside h2:after {
    content: " ▸ ";
  }
  .navshown {
    width: 50%;
    transition: 0.5s;
    background-color: rgba(16, 13, 13, 0.95);
  }
  .subShow > ul {
    visibility: visible;
    display: block;
    transition: 0.5s;
  }
  .subShow > a:not(:only-child):before {
    content: " ▾ ";
  }

  .toc-invisible {
    visibility: hidden;
  }
  .navside > .toc-invisible {
    visibility: visible;
  }
  .navshown > .toc-invisible {
    visibility: visible;
  }
  </style>
</head>
<body>

<header>
<h1 class="title">Lorebook Generation Tutorial</h1>
<blockquote class="metadata">
  <p class="date before-toc"><time datetime="Last updated 17/11/2023 at 17:38">Last updated 17/11/2023 at 17:38</time></p>
</blockquote>
</header>

  <nav id="TOC" role="doc-toc">
      <h2 id="toc-title">Contents</h2>
    <ul>
    <li><a href="#general-concept-and-theme-general_concept_and_theme">General Concept and Theme {#general_concept_and_theme}</a></li>
    <li><a href="#factions">Factions</a></li>
    <li><a href="#characters">Characters</a></li>
    <li><a href="#locations">Locations</a></li>
    <li><a href="#testing">Testing</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    </ul>
</nav>

<main>
<p><em>By: OccultSage, help from Cass, Pause</em></p>
<h3 id="general-concept-and-theme-general_concept_and_theme">General Concept and Theme {#general_concept_and_theme}</h3>
<p>So, we have the barest glimmering of a scenario idea or theme.</p>
<p>We want it to be surrealistic, almost like Alice in Wonderland. There's an AI module for that, so we go ahead and select our user-made module <em>OccultSage's Surrealistic Look Through the Looking-glass</em> from the Modules drop down. This was downloaded and added at a prior time.</p>
<p>Let's demonstrate the in-line capabilities, so we type the following into the story text: <code>Carnival of Souls</code></p>
<p>We highlight, and right-click (or ctrl-click on mobile devices with a keyboard). This should pop up a context menu. We then click -&gt; <strong>Generate Lore...</strong> -&gt; <strong>Concept</strong></p>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/7086fa16-e765-4230-b717-edb306c1c14b" alt="image" /></p>
<p>This pops up a <strong>New Lorebook Entry</strong> view in the Lorebook manager, and fills in the <strong>Description</strong> field with <code>Carnival of Souls</code> automatically. It will generate the first entry automatically, and we get back:</p>
<pre><code>An ancient ritual where souls travel back to Earth on Halloween night, making this one of the few holidays celebrated year round. On Halloween night, people dress up grotesquely and go out trick-or treating; however, no candy is given because humans don&#39;t believe in spirits. Rather, children receive tokens known as &quot;Carnival tickets.&quot;
</code></pre>
<p>Hmm, let's try again. We hit the circle arrow <strong>Retry</strong> button. On the next generation, we got:</p>
<pre><code>A carnival has many attractions for visitors; but if you go too far down one path, you may end up lost forever. That is what happened to Edgar Allan Poe while he attended a local amusement park. Though he loved attending the rides, his interest shifted toward darker things once he came across some dark poetry written by Robert Southey.
</code></pre>
<p>Eh, uninteresting. Let's try again.</p>
<pre><code>According to legend, every year, thousands of souls pass over Styx Bridge en route for Hades&#39; realm. Unfortunately, this bridge only exists during Mardi Gras celebrations. It connects Bourbon Street to Canal Street, where many businesses remain open until dawn despite being closed all day long.
</code></pre>
<p>This is really interesting. Let's click on the <strong>Generate Entry</strong> that looks like a <strong>&gt;</strong> to get it to generate more on top of that:</p>
<pre><code>The Carnival is a time when the mortal world comes together with its counterpart in Hell—the underworld&#39;s version of New Orleans and its citizens become as one.

There are two kinds of people who come here: those looking to have fun (and get drunk) at any cost; and those seeking salvation from their sins.
</code></pre>
<p>Wow, this is a really good concept! Way to go, Sigurd. Let's keep going. Click on the <strong>Generate Entry</strong> button to continue from here.</p>
<pre><code>Those who cross Styx will never be seen again. However, if they survive the experience, they may ascend back up into Heaven to find joy and happiness once more. And that brings us to...

&quot;I don&#39;t know how I&#39;m going to make it through tonight,&quot; Carlos said quietly after taking another sip from his flask. &quot;What was I thinking?&quot;
</code></pre>
<p>So, let's trim the dialog off, and we have a nice lorebook entry describing the <strong>Concept</strong> of our scenario or world.</p>
<p>The sum total of our <strong>Concept</strong> entry is:</p>
<pre><code>According to legend, every year, thousands of souls pass over Styx Bridge en route for Hades&#39; realm. Unfortunately, this bridge only exists during Mardi Gras celebrations. It connects Bourbon Street to Canal Street, where many businesses remain open until dawn despite being closed all day long.

The Carnival is a time when the mortal world comes together with its counterpart in Hell—the underworld&#39;s version of New Orleans and its citizens become as one.

There are two kinds of people who come here: those looking to have fun (and get drunk) at any cost; and those seeking salvation from their sins. Those who cross Styx will never be seen again. However, if they survive the experience, they may ascend back up into Heaven to find joy and happiness once more.
</code></pre>
<p>Nice! Let's give the lorebook entry the name of <code>Carnival of Souls</code>, and key it to <code>Carnival</code> and <code>Souls</code> under <strong>Keys</strong>.</p>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/e0c52543-c809-485e-920b-0f77e200cc50" alt="image" /></p>
<hr />
<h3 id="factions">Factions</h3>
<p>Now that we have a general theme defined, lets create a <strong>Faction</strong>. We click on <strong>+ Add Entry</strong> and create a new blank entry. We select <code>Faction</code> from the <strong>Category</strong> drop down.</p>
<p>We want to make sure that our <strong>Concept</strong> entry is included in the context, so we click on the <strong>Add Context (advanced)</strong> button in the upper right corner. This will pop down something that looks like:</p>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/5f6a2fba-2137-43c2-bd75-4cd1e1de738b" alt="image" /></p>
<p>We click on the <strong>Lorebook keys</strong> text entry box, and type in <code>Carnival of Souls</code>. This will cause the Lorebook Generator to pull the entry we just made into its context.</p>
<p>What kind of people/group would work at the Carnival of Souls? Ah-ha, <strong>Carnies</strong>, the workers in the Carnival of Souls. We type <code>the Carnies (workers)</code>, and click on <strong>Generate Entry</strong>/<strong>&gt;</strong> to submit the text and lorebook entry for generation.</p>
<p><strong>NOTE:</strong> Preceding the text with <strong>a</strong>, <strong>an</strong> or <strong>the</strong> has special meaning to the generator! It will more accurately generate for concepts or groups of people rather than a specific entity.</p>
<p><strong>NOTE2:</strong> The generator works best if short tags are used inside parentheses <code>()</code>, divided by commas, such as <code>(workers)</code></p>
<hr />
<p>On the first generation we get the following output:</p>
<pre><code>Most carnival workers aren&#39;t very skilled or experienced laborers. Some, however, do possess skills needed by the circus industry—such as acrobatics or working animals. These men and women dress like clowns, and act out exaggerated versions of everyday activities such as eating popcorn or juggling balls. Many wear masks, gloves, and colorful costumes to complete their performances.
</code></pre>
<p>We generate more, and we get the following added:</p>
<pre><code>The most common jobs among these performers include Clown Alley Managers, Ringmasters, Big Top Supervisors, Circus Performers, Animal Caretakers, Dancers, Entertainer Trainees, Tilt-A-Whirl Operators, Carpenters, Stagehands, and Truck Drivers.
</code></pre>
<p>Hmm, we're getting there. But it's not really tied to a <code>Carnival of Souls</code>, so let's add a tag, <code>demonic</code>, so that our entry looks like <code>the Carnies (workers, demonic)</code>. We delete the text, and click on <strong>Generate Entry</strong> again. After multiple generation we get the following:</p>
<pre><code>There used to be dozens of carnival sideshows across the Old World, each run by independent owners. Some held the rights to perform specific acts while others specialized in particular attractions like fortune-telling tents, freak shows, and even torture devices. These days there are very few carnivals left, due to the efforts of the Church Universal and Triumphant to stamp out evil wherever they find it. They&#39;ve outlawed most forms of entertainment that aren&#39;t directly related to worshiping Satan or spreading his word. This means no traveling actors, mimes, jugglers, musicians, magicians, acrobats, dancers... you name it. Even licensed carnival workers can lose their licenses if caught performing an act deemed &quot;unholy.&quot; So now there are just a handful of carnival sideshow operators still running around the globe. Most use their profits to fund underground operations such as demonology research. If anyone needs them, they&#39;re usually available.

The work isn&#39;t always glamorous but, unlike most other jobs, working on a carnival side show doesn&#39;t require much training.
</code></pre>
<p>This is really interesting, but not quite what we're looking for. So we reverse the order of tags: <code>the Carnies (demonic, workers)</code>, and press <strong>Retry</strong>:</p>
<pre><code>After hundreds of years of service, carnival entertainers were given demonic contracts so that they would continue performing even if forced out of Hell. These demons now work alongside humans in the mortal realm, providing entertainment while aiding humanity in battle against evil entities like vampires and serial killers. Most carnivals still feature human performers but some carnivals have begun hiring demon employees instead. Some examples include Circus Maximus in Las Vegas, which hires both demons and traditional circus stars alike. Other carnivals hire professional clowns, jugglers, acrobats and trapeze artists. In addition, there are also small-scale carnival events that take place around large cities such as Seattle or San Francisco, these smaller events often focus on live music performances by local bands.
</code></pre>
<p>OK, wow! This is exactly the sort of thing we want, so let's store this lorebook entry. We save it as <code>Faction: Carnies</code>, keyed to <code>workers</code>, <code>sideshow</code>, and <code>Carnies</code>.</p>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/5ff5de2e-ac1b-42b1-96fc-bc342c0a4286" alt="image" /></p>
<p>So let's generate another faction: <code>the Carnival Management</code>. We click on <strong>+ Add Entry</strong>, and then we select <code>Faction</code> from the <strong>Category</strong> drop-down, and we key in our prior keys, <code>carnies, carnival</code> in the <strong>Lorebook keys' field to give the</strong>Lorebook Generator''' more context.</p>
<p>We then type in <code>the Management (carnival, demonic)</code> -- it takes a few tries to get the right sort of vibe we're looking for, but we get:</p>
<pre><code>Many demons seek employment with carnivals because of how well paid and stable jobs tend to be compared to working under someone else. Others come simply because they enjoy entertaining crowds. Still others come merely to escape boredom. Either way, carnivals provide everything necessary to sustain life in Hell. Demons earn money enough to keep themselves fed and clothed without ever lifting a finger. They can spend most of the rest of each day lounging about doing nothing important, save perhaps enjoying a nice meal. As far as amusements go, few things could possibly satisfy them better than carnivals. Every single attraction has been painstakingly designed to make demons smile.

The management of a carnival consists mostly of high level demons called &quot;masters.&quot; Masters oversee operations across multiple locations and manage the various attractions within specific areas. All masters receive gifts from God upon reaching Level 50. Their duties consist mainly of overseeing security forces and making sure no damage occurs to any part of the carnival grounds. If anything does happen, it must first be reported to an officer before going through proper channels.
</code></pre>
<p>This generated good content for demons, so we split the first paragraph into a new Lorebook entry, <code>Species: Demon</code>, and we save the second paragraph as <code>Faction: Management</code>.</p>
<p>Now would be a good time to show the <strong>Generation History</strong> feature -- it will show the last 50 generations across contexts.</p>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/a5217e70-76b2-4423-a4fd-905babeb1c3c" alt="image" /></p>
<p>Thus far, we now have the following Lorebook entries:</p>
<ul>
<li><code>Faction: Carnies</code> (keys: Carnies, sideshow, workers)</li>
<li><code>Faction: Management</code> (keys: management, manager)</li>
<li><code>Species: Demon</code> (keys: demon, demons)</li>
<li><code>The Carnival of Souls</code> (keys: Carnival, Souls) <img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/a6c5eb89-6b40-4d34-bad9-7f78873d0573" alt="image" /></li>
</ul>
<hr />
<h3 id="characters">Characters</h3>
<p>Now that we have the basic skeleton of <strong>Concept</strong>, <strong>Faction</strong> and <strong>Species</strong>, let's create a few characters!</p>
<p>We click on <strong>+ Add Entry</strong>, select from the <strong>Category</strong> drop down <code>Person</code>.</p>
<p>We make sure that our lorebook keys incorporate all our entries: <code>carnival, demon, carnies, management</code></p>
<p>Hmm, we need a ringmaster! So, we type in <code>the Ringmaster (demonic, management)</code>. And because of all the context we've built up so far, it actually gives us an interesting and relevant character on the first shot!</p>
<pre><code>Lord Samhain is one of the highest ranking demons living in Hell. He oversees several different types of carnivals throughout the land. One of these carnivals includes Circus Maximus, one of the largest circuses currently operating in the mortal realm. The carnival served as a training ground for Lord Samhain himself, allowing him to hone the skills needed to run one of these massive operations.
</code></pre>
<p>Good enough, so let's save this as <code>Character: Lord Samhain</code>, keyed to <code>ringmaster</code>, <code>samhain</code>, <code>lord</code>, and <code>management</code>. We also insert <code>is the Ringmaster</code> in the text to tell Sigurd that this is our Ringmaster, ending up with the following sentence: <code>Lord Samhain is the Ringmaster, and one of the highest ranking demons living in Hell.</code></p>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/c0adfd45-b9f3-4b3f-93be-ec97aa4c9969" alt="image" /></p>
<p>Let's create a lower level employee, maybe a sideshow attraction? We follow the same steps above to create a new <code>Person</code> lorebook entry, and we enter in <code>a sideshow attraction (carnie, worker)</code></p>
<p>We get the following output on the first attempt:</p>
<pre><code>The Freakshow hosts a number of attractions, including displays of body modification, hypnotism, contortionists, fire eaters, and more. There are plenty of freaks here, too. Many of them have unusual abilities, some more surprising than others. Some of the freakiest exhibits include Miss Lizzie West—an incredibly talented female illusionist whose ability allows her to control light; Mr. Bones —a skeleton soldier who fights using his own bone gun; and Dr. Frankenstein...who makes you forget your name! But he&#39;s not alone. His assistant, Igor, knows more tricks than anyone alive. For example, did you know that Igor can turn invisible? And that he&#39;ll steal your soul right off your bones?! The ringmaster is always watching.
</code></pre>
<p>OK, this didn't generate a specific character, but this makes a neat lorebook entry for <code>Location: The Freakshow</code>, so we store that entry and key it to <code>freakshow</code>, <code>carnies</code>, <code>carny</code>.</p>
<p>Let's use the neat characters in the <code>Location: Freakshow</code> above to generate more lorebook entries. We click on <strong>+ Add Entry</strong>, and for the description entry: <code>Miss Lizzie West (female illusionist, freakshow)</code>. This demonstrates as well that the description itself will invoke lorebook keys, such as <code>freakshow</code>.</p>
<p>We get on the first shot:</p>
<pre><code>Miss Elizabeth &quot;Lizzie&quot; West is a young girl who works at Circus Maximus. She began performing magic tricks at age six, after discovering she loved entertaining people. Since then, she has developed many new illusions using both sleight of hand and stagecraft techniques. After performing at several carnivals across America, she eventually made her way to Circus Maximus. While there, she performed many shows, earning herself quite a reputation among the other guests. According to the manager, Miss West is the best magician in all of the American carnival circuit.

Her talent lies in creating elaborate illusions that hide secrets inside of objects. Her favorite trick involves hiding tiny, hidden compartments filled with gold coins behind seemingly ordinary props like playing cards, fruits, and eggs.
</code></pre>
<p>Nice! So let's store this as <code>Character: Miss Lizzie West</code>, and key it to <code>Lizzie</code>, <code>West</code>, <code>Elizabeth</code>, <code>illusionist</code>.</p>
<p>Next up, we create <code>Mr. Bones</code>. Same process to create a new entry, and we type in <code>Mr. Bones (skeleton, freakshow)</code>.</p>
<p>And, nice output from Sigurd!</p>
<pre><code>Mr. Bones likes to think that he isn&#39;t really dead after all. No matter what happens, he just needs another chance to start over again. That said, when people see him coming down the street, they usually scream in fear. This causes many people to avoid walking past the entrance of the circus, despite the fact it would be much easier if they didn&#39;t. Instead, they choose to hide behind buildings or trees, hoping that the skeletons won&#39;t notice them. Even then, they don&#39;t want to walk very close. After all, Mr. Bones doesn&#39;t need eyes to track people down.

Since his arrival at Circus Maximus, Mr. Bones has learned quite a bit about the practice of magic. While he hasn&#39;t mastered it yet, he certainly understands the principles. Due to this knowledge, he plans to use his newly discovered talents to help other members of the circus. Perhaps if everyone worked together, they might stand a chance against enemies like Dracula.
</code></pre>
<p>We save this as <code>Character: Mr. Bones</code>, keyed to <code>skeleton</code>, <code>bones</code>.</p>
<p>And now for the final freakshow character, <code>Dr. Franky</code>! We've renamed him from <code>Frankenstein</code> so that it doesn't draw from Mary Shelly's work. Same process as before, but this time we type: <code>Dr. Franky (mind control, freakshow)</code>.</p>
<p>Sigurd gave us the following nice output:</p>
<pre><code>Dr. Franky uses mind-controlling drugs to create illusions and distractions while performing feats of superhuman strength. Unlike many other carnival performers, however, he isn&#39;t just trying to entertain people; rather, he wants to help humans gain power over their minds. To do this, he needs to trick everyone into thinking they&#39;ve witnessed something incredible—something that they won&#39;t soon forget. This is why he doesn&#39;t need to perform flashy tricks or use strong muscles to impress onlookers. Instead, he relies on magic to confuse the audience. By means of clever misdirection, magical effects, and hypnosis, Dr. Franky draws attention away from what really matters. Then, after the crowd becomes distracted, he plucks out whatever information he desires.
</code></pre>
<p>Awesome. We store it as <code>Character: Dr. Franky</code>, keyed to <code>franky</code>, <code>doctor</code>.</p>
<p>We could get into <code>Igor</code>, his assistant, but to keep this tutorial shorter, we won't. We now have four very interesting characters:</p>
<ul>
<li><code>Dr. Franky</code> (keys: franky, doctor)</li>
<li><code>Lord Samhein</code> (keys: Samhein, ringmaster, lord)</li>
<li><code>Miss Lizzie</code> (keys: Lizzie, Lizzie West, Elizabeth, illusionist)</li>
<li><code>Mr. Bones</code> (keys: bones, skeleton)</li>
</ul>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/433c4670-7f0e-4527-b5aa-7a26bc6f747b" alt="image" /></p>
<hr />
<h3 id="locations">Locations</h3>
<p>We already have one <strong>Location</strong> by fortuitous happenstance earlier, so maybe we need to describe the <code>Bridge of Souls</code> mentioned in the <strong>Concept</strong> generation earlier?</p>
<p>So, we create a new entry, select <code>Place</code>, and type in: <code>Bridge of Souls (Bourbon street)</code>. And on the <strong>first generation</strong>, we get an awesome description, because of all the lore we've built up!</p>
<pre><code>Bourbon Street runs parallel to Canal Street, connecting New Orleans Proper with the French Quarter. Amongst the many bars and clubs along this strip, one stands out above all others. Known simply as &quot;the Bridge,&quot; it spans over Styx River in order to connect Bourbon Street directly with the underworld below. Most tourists visit this bridge exclusively for sightseeing purposes; however, locals know that crossing Styx Bridge is actually the best way to reach the afterlife. From here, travelers can use the bridge to travel between the two realms in seconds rather than hours. The Bridge is made entirely of steel, concrete, and stone. Its height varies depending on the season, ranging anywhere from ten feet to twenty feet tall.
</code></pre>
<p>We store this as <code>Location: Bridge of Souls</code> keyed to: <code>bridge</code>, <code>souls</code>, <code>canal</code>, <code>bourbon</code>.</p>
<hr />
<h3 id="testing">Testing</h3>
<p>Now that we've pulled together <strong>Concept</strong>, <strong>Factions</strong>, <strong>Characters</strong>, and <strong>Locations</strong>, let's run a test prompt in our story!</p>
<pre><code>I&#39;ve heard a lot about the Carnival of Souls, and I&#39;m rather curious about it. So I arrive at Bourbon Street in New Orleans, and I see the Freakshow placed at the entrance.
</code></pre>
<p>We generate, and we get back:</p>
<pre><code>A sign hangs overhead reading:

Welcome to the Freaksville Circus of Souls. Come one, come all! We&#39;re having an amazing show tonight! Don&#39;t miss it!

&quot;Wow!&quot; I exclaim aloud. This place really does seem like something straight out of a fairytale or nightmare. As I approach, a man dressed as a clown calls my attention. He waves me over.

&quot;Hey there, stranger. What brings you to our little circus?&quot; asks the Clown.

&quot;Well...&quot; My eyes dart around nervously. &quot;...I was just wondering what kind of shows go on here.&quot;

The Clown laughs heartily. &quot;Oh boy, do we ever! You&#39;ll love &#39;em, trust me! Now, let&#39;s get inside so we don&#39;t keep everyone waiting.&quot;
</code></pre>
<p>Hmm, the Clown seems like an interesting character. So let's create a lorebook entry for him. We highlight <code>the Clown</code> and right click on the context menu -&gt; <strong>Generate Lore</strong> -&gt; <strong>Person</strong>. As it uses the lorebook keys we have been carrying from generation to generation, we get back:</p>
<pre><code>Willard, originally known as &quot;Clown,&quot; is a male circus performer. Originally hailing from Earth, Clown left behind family and friends when he came to live among the other clowns in Hell. Now, Clown works alongside fellow demons to entertain crowds while keeping evil spirits at bay. Despite working closely together, Clown tends to avoid social interaction. This helps to protect his identity, as Clown doesn&#39;t want to risk outing himself to anyone outside the circus. In addition to fighting evil spirits, Clown uses his magic acts to help the denizens of Hell achieve enlightenment and return home after death. By summoning powerful spirits to aid in battles, Clown can throw whole armies into disarray.
</code></pre>
<p>Nice! So, let's store this Lorebook entry under <code>Character: the Clown</code>, keyed to <code>Willard</code> and <code>clown</code>. We also add <code>freakshow</code> to the key, to make sure he's with that group.</p>
<p>We continue generating the story, and we get:</p>
<pre><code>We enter through the front door and walk down a dark corridor lit by flickering torches. Finally, we stop before a large wooden double-door. The Clown knocks twice, then opens both doors simultaneously. The crowd erupts into cheers.

Inside, the venue resembles a small stadium. In the center of the arena sits a raised stage surrounded by several tiers of seating. Several dozen performers are already seated upon these platforms. They wear colorful costumes and dance wildly to the music playing throughout the room.

A number of people sit atop the lowest tier, watching the performance. Others stand nearby, drinking drinks that appear to be made entirely from alcohol. There is even someone who appears to have been turned completely black; they are dancing with a white woman wearing nothing but body paint. All of them laugh loudly as their bodies move rhythmically.

A few feet away from this group stands another cluster of revelers. These people are laughing uproariously, slapping each other on the back and hugging each other tightly. It seems almost as though they were enjoying some sort of religious experience.

Other groups of people gather in different areas of the stadium.
</code></pre>
<p>It's safe to call this a success.</p>
<hr />
<h3 id="conclusion">Conclusion</h3>
<p>We've come from the glimmerings of an idea to a neat immersive world -- using text generated purely by Sigurd and a strategic choice of modules! We've created eleven lorebook keys, encompassing the beginnings of an awesome scenario.</p>
<p>This is a general outline intended to follow other service's <strong>World Generator</strong> flow, but other workflows can be used.</p>
<hr />
<p>The lorebook generated for this tutorial has been attached here as a PNG for your perusal.</p>
<p><img src="https://github.com/TapwaveZodiac/novelaiUKB/assets/35267604/dc506e5f-3081-45f5-9ce0-0a3a830d62a7" alt="image" /></p>

<!-- Javascript added by toc-css.lua to make TOC expandable on click -->
<script>

  const b = document.querySelector("body");
  const n = document.querySelector("nav");
  const buttonsize = 15;

  // click on "toc-title" to show TOC to the side
  document.querySelector("#toc-title").addEventListener("click", function(e) {
    if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize) {
      n.classList.toggle("navshown");
    } else {
      b.classList.toggle("paddingleft");
      n.classList.toggle("navside");
      n.classList.remove("navshown");
    };
  });

  // by default show TOC in large window
  window.onload = function() {
    if (window.innerWidth > 1000) {
      b.classList.add("paddingleft");
      n.classList.add("navside");
    };
  };

  // show/hide TOC on resize
  window.onresize = function () {
    // scrolling on mobile devices triggers resize, so we disable it altogether (for now)
    if (typeof window.orientation !== 'undefined') {
      return;
    };

    if (window.innerWidth > 1000) {
      b.classList.add("paddingleft");
      n.classList.add("navside");
    } else {
      b.classList.remove("paddingleft");
      n.classList.remove("navside");
    };
  };

  // show/hide subsections
  const allLis = document.querySelectorAll("nav li");

  for (const li of allLis) {
    li.addEventListener('click', function (e) {
      // show/hide subsection if arrow is clicked
      if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize
        && e.clientY < e.currentTarget.getBoundingClientRect().top + buttonsize) {

        li.classList.toggle('subShow');
        e.preventDefault();
      };

      // hide full nav if clicked outside
      if (e.currentTarget.getBoundingClientRect().left + 3*buttonsize < e.clientX) {
        n.classList.remove("navshown");
      };
    });

    li.classList.add('subShow');
  };

  // hide ToC if no overruling
  document.querySelector("nav ul").classList.add("toc-invisible");

  // show full nav on tab, hide full nav on escape
  document.addEventListener("keydown", function (e) {
    if (e.which === 27) {
      n.classList.remove("navshown");
      e.preventDefault();
    };
    if (e.which === 9) {
      n.classList.add("navshown");
      e.preventDefault();
    };
  });

  // insert key info
  n.insertAdjacentHTML("beforeend", "<span class='toc-invisible'> \
                                     <br/> \
                                     <p>Press <kbd>Tab</kbd> to show extended width TOC.</p> \
                                     <p>Presss <kbd>Esc</kbd> to go back to normal width.</p> \
                                     </span>");

  // hide full nav when clicked outside
  document.addEventListener("click", function(e) {
    if (n.classList.contains("navshown")) {
      if (!n.contains(e.target)) {
        n.classList.remove("navshown");
      };
    };
  });

</script>
</main>

</body>
</html>
