<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Image Generation</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <!-- CSS added by filter 'toc-css.lua' for TOC hovering to the side -->
  <!-- TODO: try doing sometthing in px instead of cm to make it more device independent -->
  <style>
  body {
    padding-left: 1.5cm;
    padding-right: 1cm;
    transition: 0.5s;
  }
  nav {
    width: 1cm;
    margin-left: -1.5cm;
    font-size: smaller;
    color: grey;
    transition: 0.5s;
    float: left;
    position: fixed;
    top: 0;
    bottom: 0;
    white-space: nowrap;
    overflow: hidden;
    overflow-y: scroll;
    transition: 0.5s;
    z-index: 10;
  }
  nav::-webkit-scrollbar {
    display: none;
  }
  nav a, nav a:visited {
    color: grey;
  }
  nav h2:before {
    content: "‚â° ";
    font-size: 150%;
  }
  nav h2:after {
    content: " ‚óÇ";
  }
  nav li {
    margin-left: 1em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  nav li > a:not(:only-child):before {
    content: "‚ñ∏ ";
  }
  nav li > a:only-child {
    margin-left: 0.75em;
  }
  nav li li {
    margin-left: 1em;
  }
  nav li li li {
    margin-left: 0.5em;
    font-size: smaller;
  }
  nav ul li ul  {
    visibility: hidden;
    display: none;
    margin-top: 0.2em;
    margin-bottom: 0.2em;
    transition: 0.5s;
  }
  .paddingleft {
    padding-left: 9cm;
    transition: 0.5s;
  }
  .navside {
    width: 7cm;
    margin-left: -8.5cm;
    padding-right: 1cm;
    transition: 0.5s;
  }
  .navside h2:after {
    content: " ‚ñ∏ ";
  }
  .navshown {
    width: 50%;
    transition: 0.5s;
    background-color: rgba(255, 255, 255, 0.95);
  }
  .subShow > ul {
    visibility: visible;
    display: block;
    transition: 0.5s;
    margin-left: -1em;
  }
  .subShow > a:not(:only-child):before {
    content: " ‚ñæ ";
  }

  .toc-invisible {
    visibility: hidden;
  }
  .navside > .toc-invisible {
    visibility: visible;
  }
  .navshown > .toc-invisible {
    visibility: visible;
  }
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Image Generation</h1>
</header>
<nav id="TOC" role="doc-toc">
<h2 id="toc-title">Contents</h2>
<ul>
<li><a href="#how-is-the-ai-trained">How is the AI trained?</a></li>
<li><a href="#tag-based-prompting">Tag-based Prompting</a>
<ul>
<li><a href="#quality-tags">Quality Tags</a></li>
<li><a href="#counting-characters-and-gender">Counting Characters and Gender</a></li>
<li><a href="#character-reference-and-artist-reference">Character Reference and Artist Reference</a></li>
<li><a href="#tag-interaction">Tag Interaction</a></li>
<li><a href="#facial-expressions">Facial Expressions</a></li>
</ul></li>
<li><a href="#prose-prompting">Prose Prompting</a>
<ul>
<li><a href="#story-conversion">Story Conversion</a></li>
<li><a href="#clip-interrogator">CLIP Interrogator</a></li>
<li><a href="#combo-prompting">Combo Prompting</a></li>
</ul></li>
</ul>
</nav>
<p><strong>This guide is focused on nascent technology. As a result, contents might be highly volatile.</strong></p>
<p>Anlatan already provides an in-depth guide to using their Image Generation service <a href="https://docs.novelai.net/">here</a>. It is highly recommended you read it thoroughly because it explains every functionality and all pieces of the UI in great detail.</p>
<p>You should also read <a href="https://github.com/TravelingRobot/NAI_Community_Research/wiki/NAI-Diffusion:-Various-Tips-&amp;-Tricks">Traveling Robot's research notes</a> as well. This guide expounds on some of them.</p>
<p>This guide aims to provide with more in depth information for power users.</p>
<p><strong>For people looking for the magic voodoo to create NSFW artwork: Add NSFW to the prompt. Anywhere.</strong></p>
<p>The default Unwanted Content is as follows:</p>
<p><strong>Low Quality:</strong> <code>lowres, text, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry</code></p>
<p><strong>Low Quality +Bad Anatomy:</strong> <code>lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry</code></p>
<hr />
<h1 id="how-is-the-ai-trained">How is the AI trained?</h1>
<p>The AI was trained on tagged images, based on the Danbooru standard. Boorus are "imageboards", sites where large amounts of images are saved in order to catalogue the body of work of artists. This stemmed from a difficulty to find and archive art reliably, as Japanese artists have a very different relationship with their works than Western cultures do.</p>
<p>As a result, these sites were created to host as many images as possible, and make them easy to find by applying tags. These tags describe elements of the image, such as character design elements (hair, eyes, etc), poses, objects, and much more.</p>
<p>If you are going to go and trawl Danbooru's tag database, keep in mind that the site is <strong>extremely unsafe for work!</strong></p>
<p>If you are using the Furry model, <strong>you'll need to use E621's tags.</strong> This means all the following information will not work for this specific model. E621 is just as extremely unsafe for work.</p>
<hr />
<h1 id="tag-based-prompting">Tag-based Prompting</h1>
<p>To use Tags in NAIDiffusion, simply assemble a list of tags freely. Use commas to separate tags. While tags on Boorus use underscores instead of spaces, the parser replaced all underscores 'with spaces' to make it easier to write prompts.</p>
<p>Thus, write prompts with spaces in them if they use multiple words, and bound them with commas. Forgetting a comma might cause the prompt to be interpreted incorrectly.</p>
<p>Something that is important to note is that prompts are interpreted with linear priority, which is the reverse of text generation. What comes first has more weight, but the rest is more or less normalized in strength.</p>
<p><strong>When weighing tags with curly braces or square brackets, stacking them has a multiplicative effect, rather than additive</strong>.</p>
<p>Tag-based prompts tends to lead to consistent designs. However, they come out stylistically different and less diverse than Prose-based prompts.</p>
<p>There are several tag categories that are important to know, due to how extensively they were used in tagging.</p>
<h3 id="quality-tags">Quality Tags</h3>
<p>You may have heard of the <code>masterpiece</code> tag being used to "improve generation quality". This goes a little bit more in depth.</p>
<p>Images were classified according to a percentile "quality score". Different tags were then applied to training images based on that score. From highest percentiles to lowest percentiles:</p>
<p><code>masterpiece, best quality, high quality, normal quality, low quality, worst quality</code></p>
<p>If you use any of the Unwanted Content default filters, the latter two are automatically put in Unwanted Content. You can disable the filter or write them in your prompt to activate them anyway.</p>
<p>You only need one tag, though generally you won't need one. It is better to downbias bad things than overly bias "good" things, as this may damage creativity. Generally just using the default Unwanted Content filters will be fine.</p>
<h3 id="counting-characters-and-gender">Counting Characters and Gender</h3>
<p>One of the ubiquitous booru tags is the gender count tag. Whenever there is a number of characters in frame, then they are counted by gender.</p>
<p>The tag format is always the same. A number from one to 6 (with a plus if more than 6), followed immediately by the gender. <code>1boy, 2girls</code></p>
<p>You can also use <code>other</code> as a gender for androgynous or transgender characters. Generally, they will look rather feminine nonetheless.</p>
<p>This tag is almost universally put in first position because it starts with a number rather than a letter, but you can put it anywhere. Those tags are <strong>very</strong> powerful, so you might not even need to use them, if you simply describe a character. It is mostly to make sure you have that number of characters in frame, or reinforce gender expectations.</p>
<p>If you are looking to generate gender noncomforming characters, here are a few tags.</p>
<p><code>twink, otoko no ko, "girl, flat chest"</code> can help generate soft boys.</p>
<p><code>masculine, tough</code> can help generate butch girls.</p>
<h3 id="character-reference-and-artist-reference">Character Reference and Artist Reference</h3>
<p>After you specified quality and character number/gender, you'll want to specify, if applicable, the <strong>Reference Character</strong>, if you are generating a known character from another franchise. After that, append <code>by</code> and the artist name.</p>
<p>For example, if you want to generate Makoto Kusanagi in the style of the latest Ghost in the Shell production, you would use:</p>
<p><code>Kusanagi Makoto by Ilya Kuvshinov</code></p>
<p>Keep in mind that Boorus use Japanese name order, meaning that family name comes first.</p>
<p>You can, of course, put this information anywhere else, this is simply how file names are generally arranged.</p>
<h3 id="tag-interaction">Tag Interaction</h3>
<p>An easy way to mess up your generations ( or improve them!) is to have tags that interact. One common example of tags overwriting each other is as follows:</p>
<p><code>1girl, brown hair, blue eyes, sleeping, eyes closed, laying down</code></p>
<p>While the problem is not immediately apparent, specifying an eye colour <em>and</em> them being closed means that one will be ignored in favour of the other. Make sure you don't specify information about things that are not in frame.</p>
<p>A more positive example is:</p>
<p><code>1girl, black hair, blue highlights, blue eyes,</code></p>
<p>Putting a color highlight next to the hair color will give you colored strands and bangs. Adjust the wording until you get the sepcifics you like!</p>
<h4 id="incomplete-interactions">Incomplete Interactions</h4>
<p>Breaking up interactions that occur naturally can result in artifacts or odd elements. It is easy to achieve if you strengthen a specific part of a tag rather than the whole tag.</p>
<p><code>1girl, black hair, {{{orange}}} eyes</code></p>
<p>This can lead to the spontaneous appearance of tasty, tasty oranges everywhere in frame. Whether or not this is a bad thing is up to you.</p>
<h4 id="mutual-dependencies">Mutual Dependencies</h4>
<p>Some tags implicitly require each other and can lead to artifacts or tags being ignored if one of them is banned through Undesired Content. For example, requesting <code>gloves</code> but having <code>hands</code> in Undesired Content can lead to weird generations. Make sure you account for these dependencies to avoid this!</p>
<h3 id="facial-expressions">Facial Expressions</h3>
<p>You'll quickly realize that facial expression tags are non-intuitive and lead to odd faces. This is because emotions aren't often tagged, and their vectors are surprisingly strong. Try <code>tired</code> and you'll see what this leads to. Some like <code>pensive</code> work fine as is.</p>
<p>Thus, make sure you always reduce the strength of your facial expression vectors. This also goes for <code>crying, tears</code>, and anything that is extremely powerful on its own.</p>
<p>To do so, add square brackets around the tag: <code>[tired]</code> add more brackets if necessary.</p>
<p>There are various emotes that can be used as facial expressions, with fairly strong vectors: <code>:), :(, :3</code> and so on.</p>
<p>Be aware that some, like :|, can break the prompt. Try using an emoji instead: üòê</p>
<hr />
<h1 id="prose-prompting">Prose Prompting</h1>
<p>To prose-prompt in NAIDiffusion, simply write a sentence describing the image. Use commas to separate clauses. Try to keep clauses short and using as little grammatical words as possible. Try to phrase your sentences so that you use vocabulary close to Booru tags.</p>
<p>Again, prompts are interpreted with linear priority, which is the reverse of text generation. What comes first has more weight, so keep the core content at the beginning of the sentence.</p>
<p>Prose-based prompts tends to lead to more varied output. They are stylistically different and more diverse than Tag-based prompts, and are best suited for situations or scenes which are very dynamic and which do not require consistent character portrayal.</p>
<h3 id="story-conversion">Story Conversion</h3>
<p>You can, with some slight adjustments, copy paste excerpts from your story and use them as prompts. There might be some fine tuning needed, but you should get something similar to what was described.</p>
<h3 id="clip-interrogator">CLIP Interrogator</h3>
<p><a href="https://colab.research.google.com/github/pharmapsychotic/clip-interrogator/blob/main/clip_interrogator.ipynb#scrollTo=YQk0eemUrSC7">Clip Interrogator</a> can be used to read an image you like and extract tags and prose that will help you refine your prompt.</p>
<h2 id="combo-prompting">Combo Prompting</h2>
<p>If you are generating an image of a specific character that has a small amount of pictures, you can combine a prose prompt and tags appends in order to obtain something closer to the desired result.</p>
<p><code>a picture of {ayanami} from azur lane, white hair, red eyes, ponytail,</code></p>
<!-- Javascript added by darkmode.lua to allow dark mode button -->
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<script>
  function addDarkmodeWidget() {
    const darkmode_options = {
      mixColor: '#fff', // default: '#fff'
      backgroundColor: '#fff',  // default: '#fff'
      buttonColorDark: '#100f2c',  // default: '#100f2c'
      buttonColorLight: '#fff', // default: '#fff'
      label: 'üåì',
    }

    new Darkmode(darkmode_options).showWidget();
  }
  window.addEventListener('load', addDarkmodeWidget);
</script>


<!-- Javascript added by toc-css.lua to make TOC expandable on click -->
<script>

  const b = document.querySelector("body");
  const n = document.querySelector("nav");
  const buttonsize = 15;

  // click on "toc-title" to show TOC to the side
  document.querySelector("#toc-title").addEventListener("click", function(e) {
    if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize) {
      n.classList.toggle("navshown");
    } else {
      b.classList.toggle("paddingleft");
      n.classList.toggle("navside");
      n.classList.remove("navshown");
    };
  });

  // by default show TOC in large window
  window.onload = function() {
    if (window.innerWidth > 1000) {
      b.classList.add("paddingleft");
      n.classList.add("navside");
    };
  };

  // show/hide TOC on resize
  window.onresize = function () {
    // scrolling on mobile devices triggers resize, so we disable it altogether (for now)
    if (typeof window.orientation !== 'undefined') {
      return;
    };

    if (window.innerWidth > 1000) {
      b.classList.add("paddingleft");
      n.classList.add("navside");
    } else {
      b.classList.remove("paddingleft");
      n.classList.remove("navside");
    };
  };

  // show/hide subsections
  const allLis = document.querySelectorAll("nav li");

  for (const li of allLis) {
    li.addEventListener('click', function (e) {
      // show/hide subsection if arrow is clicked
      if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize
        && e.clientY < e.currentTarget.getBoundingClientRect().top + buttonsize) {

        li.classList.toggle('subShow');
        e.preventDefault();
      };

      // hide full nav if clicked outside
      if (e.currentTarget.getBoundingClientRect().left + 3*buttonsize < e.clientX) {
        n.classList.remove("navshown");
      };
    });

    li.classList.add('subShow');
  };

  // hide ToC if no overruling
  document.querySelector("nav ul").classList.add("toc-invisible");

  // show full nav on tab, hide full nav on escape
  document.addEventListener("keydown", function (e) {
    if (e.which === 27) {
      n.classList.remove("navshown");
      e.preventDefault();
    };
    if (e.which === 9) {
      n.classList.add("navshown");
      e.preventDefault();
    };
  });

  // insert key info
  n.insertAdjacentHTML("beforeend", "<span class='toc-invisible'> \
                                     <br/> \
                                     <p>Press <kbd>Tab</kbd> to show extended width TOC.</p> \
                                     <p>Presss <kbd>Esc</kbd> to go back to normal width.</p> \
                                     </span>");

  // hide full nav when clicked outside
  document.addEventListener("click", function(e) {
    if (n.classList.contains("navshown")) {
      if (!n.contains(e.target)) {
        n.classList.remove("navshown");
      };
    };
  });

</script>
</body>
</html>
